server:
  host: 0.0.0.0
  port: 8080

theme:
  light: false
  background-color: 225 14 10
  primary-color: 157 64 60
  positive-color: 115 54 76
  negative-color: 0 90 60
  contrast-multiplier: 1.1
  text-saturation-multiplier: 0.5

branding:
  logo-text: fs0ciety
  logo-url: https://fs0ciety.org/logo.svg
  favicon-url: https://fs0ciety.org/favicon.ico

pages:
  # ============================================================
  #  HOME
  # ============================================================
  - name: Home
    slug: home
    width: wide
    head-widgets:
      - type: search
        search-engine: duckduckgo
        autofocus: true

    columns:
      # ── Left column ──────────────────────────────────────────
      - size: small
        widgets:
          - type: clock
            hour-format: 24h
            timezones:
              - timezone: Europe/Brussels
                label: Mons

          - type: calendar
            first-day-of-week: monday

          - type: custom-api
            title: Immich Stats
            title-url: ${IMMICH_URL}
            cache: 5m
            url: ${IMMICH_URL}/api/server/statistics
            headers:
              x-api-key: ${IMMICH_API_KEY}
              Accept: application/json
            template: |
              <div class="flex justify-between text-center">
                <div>
                    <div class="color-highlight size-h3">{{ .JSON.Int "photos" | formatNumber }}</div>
                    <div class="size-h6">PHOTOS</div>
                </div>
                <div>
                    <div class="color-highlight size-h3">{{ .JSON.Int "videos" | formatNumber }}</div>
                    <div class="size-h6">VIDEOS</div>
                </div>
                <div>
                    <div class="color-highlight size-h3">{{ div (.JSON.Int "usage" | toFloat) 1073741824 | toInt | formatNumber }}GB</div>
                    <div class="size-h6">USAGE</div>
                </div>
              </div>

          - type: custom-api
            title: Astronomy Picture of the Day
            cache: 1d
            url: https://api.nasa.gov/planetary/apod?api_key=${NASA_API_KEY}
            headers:
              Accept: application/json
            template: |
              {{- if eq (.JSON.String "media_type") "image" -}}
                <div style="display:flex; flex-direction:column; align-items:center; width:100%; padding:8px; box-sizing:border-box;">
                  <p class="color-primary" style="margin:0 0 8px; text-align:center;">
                    <a
                       href="https://apod.nasa.gov/apod/astropix.html"
                       target="_blank"
                       rel="noopener noreferrer"
                      style="color: inherit; text-decoration: none;"
                    >
                      {{ .JSON.String "title" }}
                    </a>
                  </p>
                  <img
                    src="{{ .JSON.String "url" }}"
                    alt="{{ .JSON.String "title" }}"
                    style="max-width:100%; height:auto; display:block; border-radius:4px;"
                  />
                  <details style="width:100%; margin-top:12px;">
                    <summary class="color-highlight size-h5" style="cursor:pointer;">
                      Show Explanation
                    </summary>
                    <p class="color-highlight size-h5" style="margin-top:8px; text-align:left; line-height:1.4;">
                      {{ .JSON.String "explanation" }}
                    </p>
                  </details>
                </div>
              {{- else -}}
                <p class="color-negative" style="text-align:center;">
                  No image available today.
                </p>
              {{- end }}

          - type: custom-api
            height: 200px
            title: Random Dog
            cache: 2m
            url: https://dog.ceo/api/breeds/image/random
            template: |
              <img src="{{ .JSON.String "message" }}"></img>

      # ── Center column ─────────────────────────────────────────
      - size: full
        widgets:
          - type: group
            widgets:
              - type: rss
                title: Tech News
                style: vertical-list
                cache: 30m
                limit: 20
                collapse-after: 8
                feeds:
                  - url: https://korben.info/feed
                    title: Korben
                  - url: https://www.theverge.com/rss/index.xml
                    title: The Verge
                  - url: https://techcrunch.com/feed/
                    title: TechCrunch
                  - url: https://www.wired.com/feed/rss
                    title: Wired
                  - url: https://fs0ciety.org/blog/rss
                    title: fs0ciety
                  - url: https://noted.lol/rss
                    title: Noted.lol

              - type: rss
                title: r/selfhosted
                style: vertical-list
                limit: 15
                collapse-after: 5
                cache: 30m
                feeds:
                  - url: https://www.reddit.com/r/selfhosted/hot.rss

              - type: rss
                title: r/privacy
                style: vertical-list
                limit: 15
                collapse-after: 5
                cache: 30m
                feeds:
                  - url: https://www.reddit.com/r/privacy/hot.rss

              - type: rss
                title: r/piracy
                style: vertical-list
                limit: 15
                collapse-after: 5
                cache: 30m
                feeds:
                  - url: https://www.reddit.com/r/piracy/hot.rss

              - type: rss
                title: r/Qubes
                style: vertical-list
                limit: 15
                collapse-after: 5
                cache: 30m
                feeds:
                  - url: https://www.reddit.com/r/Qubes/hot.rss

              - type: rss
                title: r/privacytoolsIO
                style: vertical-list
                limit: 15
                collapse-after: 5
                cache: 30m
                feeds:
                  - url: https://www.reddit.com/r/privacytoolsIO/hot.rss

              - type: hacker-news
                title: Hacker News
                limit: 15
                collapse-after: 5
                cache: 30m

          - type: videos
            title: YouTube
            cache: 1h
            channels:
              - UCus9EeXDcLaCJhVXYd6PJcg  # MisterMV
              - UCMQSwUNSnMOP4IRysfeg8EA  # SimonPuech
              - UC3zTd1p0iaS-ALWH0mLbV7A  # 
              - UC-wzCLovRXvXrXXF7vFpW5A  # 
              - UCseGV3amBLISlIOMQodPfVQ

      # ── Right column ──────────────────────────────────────────
      - size: small
        widgets:
          - type: custom-api
            title: Weather Forecast
            body-type: string
            cache: 1h
            options:
              location: Mons, Belgium
              weekend_color: "#34363D"
              color_clear: "#FFA500"
              color_partly: "#EBE387"
              color_cloud: "#A9A9A9"
              color_smog: "#D3D3D3"
              color_drizzle: "#5F9EA0"
              color_rain: "#4682B4"
              color_freezing_rain: "#B0E0E6"
              color_snow: "#FFFFFF"
              color_thunderstorm: "#696969"
              color_other: "#FFFFFF"
              color_red: "#F08C46"
              color_yellow: "#F0F046"
              color_blue: "#46F0F0"
              color_white: "#FFFFFF"
            template: |
              {{/* Weather widget – fully customizable via options */}}
              {{ $temp_unit := .Options.StringOr "temp_unit" "celsius" }}
              {{ $weekend_color := .Options.StringOr "weekend_color" "var(--color-separator)" }}
              {{ $overlay_color := .Options.StringOr "overlay_color" "hsl(var(--bghs), var(--bgl), 50%)" }}
              {{ $color_clear := .Options.StringOr "color_clear" "var(--color-text-highlight)" }}
              {{ $color_partly := .Options.StringOr "color_partly" "var(--color-text-highlight)"}}
              {{ $color_cloud := .Options.StringOr "color_cloud" "var(--color-text-highlight)"}}
              {{ $color_smog := .Options.StringOr "color_smog" "var(--color-text-highlight)"}}
              {{ $color_drizzle := .Options.StringOr "color_drizzle" "var(--color-text-highlight)"}}
              {{ $color_rain := .Options.StringOr "color_rain" "var(--color-text-highlight)"}}
              {{ $color_freezing_rain := .Options.StringOr "color_freezing_rain" "var(--color-text-highlight)"}}
              {{ $color_snow := .Options.StringOr "color_snow" "var(--color-text-highlight)"}}
              {{ $color_thunderstorm := .Options.StringOr "color_thunderstorm" "var(--color-text-highlight)"}}
              {{ $color_other := .Options.StringOr "color_other" "var(--color-text-highlight)"}}
              {{ $color_red := .Options.StringOr "color_red" "var(--color-negative)" }}
              {{ $color_yellow := .Options.StringOr "color_yellow" "var(--color-text-subdue)" }}
              {{ $color_blue := .Options.StringOr "color_blue" "var(--color-positive)" }}
              {{ $color_white := .Options.StringOr "color_white" "var(--color-text-highlight)" }}
              {{ $temp_red := .Options.FloatOr "temp_red" 27 }}
              {{ $temp_yellow := .Options.FloatOr "temp_yellow" 20 }}
              {{ $temp_blue := .Options.FloatOr "temp_blue" 10.0 }}
              {{ $temp_white := .Options.FloatOr "temp_white" 0 }}
              {{ if eq $temp_unit "fahrenheit" }}
                {{ $temp_red = .Options.FloatOr "temp_red" 80.0 }}
                {{ $temp_yellow = .Options.FloatOr "temp_yellow" 70.0 }}
                {{ $temp_blue = .Options.FloatOr "temp_blue" 50.0 }}
                {{ $temp_white = .Options.FloatOr "temp_white" 30.0 }}
              {{end}}
              {{ $location_string := replaceAll " " "%20" (.Options.StringOr "location" "") }}
              {{ $url1 := printf "https://geocoding-api.open-meteo.com/v1/search?name=%s&count=20&language=en&format=json" $location_string }}
              {{ $req1 := newRequest $url1 | getResponse }}
              {{ $latitude := $req1.JSON.String "results.0.latitude" }}
              {{ $longitude := $req1.JSON.String "results.0.longitude" }}
              {{ $url2 := printf "https://api.open-meteo.com/v1/forecast?latitude=%s&longitude=%s&temperature_unit=%s&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=Europe/Brussels" $latitude $longitude $temp_unit}}
              {{ $req2 := newRequest $url2 | getResponse }}
              <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
                {{ $dates := $req2.JSON.Array "daily.time" }}
                <div style="position: relative; width: 100%; height: 25px;">
                    {{ range $index, $date := $dates }}
                    {{ $dateString := .String "" }}
                    {{ $parsedDate := $dateString | parseTime "DateOnly" }}
                    {{ $dayOfWeek := $parsedDate.Format "Monday" | trimSuffix "day" | trimSuffix "on" | trimSuffix "es" | trimSuffix "edn" | trimSuffix "urs" | trimSuffix "ri" | trimSuffix "tur" | trimSuffix "n" }}
                      {{ $day_color := "" }}
                    {{ if eq $dayOfWeek "Sa" "Su" }}
                      {{ $day_color = $weekend_color }}
                    {{ end }}
                    <div style="text-align: center; width: 10%; height: 25px; line-height: 25px; margin: 0 10% 0 3%; left: {{ mul $index 14 }}%; position: absolute; background-color: {{ $day_color | safeCSS }} ">
                      <p class="size-h4 color-paragraph">{{ $dayOfWeek }}</p>
                    </div>
                  {{ end }}
                </div>
                <div style="position: relative; width: 100%; height: 25px;">
                      {{ range $index, $date := $dates }}
                    {{ $dateString := .String "" }}
                    {{ $trimmedDate := replaceMatches "[0-9]+-[0-9]+-" "" $dateString }}
                    <div style="text-align: center; width: 10%; height: 25px; line-height: 25px; margin: 0 10% 0 3%; left: {{ mul $index 14 }}%; position: absolute;">
                      <p class="size-h4 color-paragraph">{{ $trimmedDate }}</p>
                    </div>
                  {{ end }}
                </div>
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
                {{ $codes := $req2.JSON.Array "daily.weathercode" }}
                <div style="position: relative; width: 100%; height: 30px;">
                      {{ range $index, $thiscode := $codes }}
                    {{ $code := .Int "" }}
                    <div style="text-align: center; width: 10%; height: 25px; line-height: 25px; margin: 0 10% 0 3%; left: {{ mul $index 14 }}% ; position: absolute;">
                    {{ $wtype := "" }}
                    {{ $wicon := "" }}
                    {{ $wcolor := "" }}
                    {{ if eq $code 0 }}
                      {{ $wtype = "Clear" }}
                      {{ $wicon = "fas fa-sun" }}
                      {{ $wcolor = $color_clear }}
                    {{ else if or (eq $code 1) (eq $code 2) }}
                      {{ $wtype = "Part Clear" }}
                      {{ $wicon = "fas fa-cloud-sun" }}
                      {{ $wcolor = $color_partly }}
                    {{ else if eq $code 3 }}
                      {{ $wtype = "Cloudy" }}
                      {{ $wicon = "fas fa-cloud" }}
                      {{ $wcolor = $color_cloud }}
                    {{ else if or (eq $code 45) (eq $code 48) }}
                      {{ $wtype = "Fog" }}
                      {{ $wicon = "fas fa-smog" }}
                      {{ $wcolor = $color_smog }}
                    {{ else if or (eq $code 51) (eq $code 53) (eq $code 55) (eq $code 56) (eq $code 57) }}
                      {{ $wtype = "Drizzle" }}
                      {{ $wicon = "fas fa-cloud-rain" }}
                      {{ $wcolor = $color_drizzle }}
                    {{ else if or (eq $code 61) (eq $code 63) (eq $code 65) (eq $code 80) (eq $code 81) (eq $code 82) }}
                      {{ $wtype = "Rain" }}
                      {{ $wicon = "fas fa-cloud-showers-heavy" }}
                      {{ $wcolor = $color_rain }}
                    {{ else if or (eq $code 66) (eq $code 67) }}
                      {{ $wtype = "Freezing Rain" }}
                      {{ $wicon = "fas fa-snowflake" }}
                      {{ $wcolor = $color_freezing_rain }}
                    {{ else if or (eq $code 71) (eq $code 73) (eq $code 75) (eq $code 77) (eq $code 85) (eq $code 86) }}
                      {{ $wtype = "Snow" }}
                      {{ $wicon = "fas fa-snowman" }}
                      {{ $wcolor = $color_snow }}
                    {{ else if or (eq $code 95) (eq $code 96) (eq $code 99) }}
                      {{ $wtype = "Thunderstorm" }}
                      {{ $wicon = "fas fa-bolt" }}
                      {{ $wcolor = $color_thunderstorm }}
                    {{ else }}
                      {{ $wtype = "Other" }}
                      {{ $wicon = "fa-solid fa-question" }}
                      {{ $wcolor = $color_other }}
                    {{ end }}
                    <i class={{ $wicon }} style="font-size: 20px; color: {{ $wcolor | safeCSS }};" title={{ $wtype }}></i>
                    </div>
                  {{ end }}
                </div>
              </div>
              {{ $maxTemps := $req2.JSON.Array "daily.temperature_2m_max" }}
              {{ $minTemps := $req2.JSON.Array "daily.temperature_2m_min" }}
              <div style="display: flex; justify-content: flex-start; align-items: center;">
                {{ $max_max := 0 }}
                {{ range $maxTemps }}
                    {{ if gt (.Int "") $max_max }}
                      {{ $max_max = (.Int "") }}
                    {{ end }}
                {{ end }}
                {{ $min_min := 999 }}
                {{ range $minTemps }}
                    {{ if lt (.Int "") $min_min }}
                      {{ $min_min = (.Int "") }}
                    {{ end }}
                {{ end }}
                {{ $max_max = add $max_max 1 }}
                {{ $min_min = sub $min_min 1 }}
                <div style="position: relative; width: 100%; height: 75px;">
                  {{ $temp_range := sub $max_max $min_min }}
                  {{ range $index, $thisHigh := $maxTemps }}
                      {{ $thisLow := index $minTemps $index }}
                      {{ $thisHigh = $thisHigh.Float "" }}
                      {{ $thisLow = $thisLow.Float "" }}
                      {{ $thisHighPct := sub 1 (div (sub $max_max $thisHigh) $temp_range) }}
                      {{ $thisLowPct := div (sub $thisLow $min_min) $temp_range }}
                      {{ $thisTempRange := sub $thisHigh $thisLow }}
                      {{ $red_pos := mul 100 (div (sub $thisHigh $temp_red) $thisTempRange) | toInt }}
                      {{ $yel_pos := mul 100 (div (sub $thisHigh $temp_yellow) $thisTempRange) | toInt }}
                      {{ $blu_pos := mul 100 (div (sub $thisHigh $temp_blue) $thisTempRange) | toInt }}
                      {{ $whi_pos := mul 100 (div (sub $thisHigh $temp_white) $thisTempRange) | toInt }}
                      {{ $gradient_string := printf "%s %d%%, %s %d%%, %s %d%%, %s %d%%" $color_red $red_pos $color_yellow $yel_pos $color_blue $blu_pos $color_white $whi_pos }}
                      <div style="left: {{ mul $index 14 | add 3 }}%; bottom: {{ mul $thisLowPct 100 | toInt }}%;
                         height: {{ mul (sub $thisHighPct $thisLowPct) 100 | toInt }}%; position: absolute;
                        background:linear-gradient({{ $gradient_string | safeCSS }}); width: 10%; text-align: center; border-radius: 10px;">
                        {{ $top_pos := -2 }}
                        {{ $bot_pos := -2 }}
                        {{ $pos_thresh := 0.20 }}
                        {{ if lt (div $thisTempRange $temp_range) $pos_thresh }}
                           {{ $top_pos = -17 }}
                          {{ $bot_pos = -19 }}
                        {{ else if and (lt (div $thisTempRange $temp_range) (mul $pos_thresh 2)) (lt (sub 1 $thisHighPct) $thisLowPct) }}
                          {{ $bot_pos = -19 }}
                        {{ else if and (lt (div $thisTempRange $temp_range) (mul $pos_thresh 2)) (gt (sub 1 $thisHighPct) $thisLowPct) }}
                          {{ $top_pos = -17 }}
                        {{ end }}
                          <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: {{ $overlay_color | safeCSS }}; z-index: 1;  border-radius: 10px;">
                            <p style='color: #F0F0F0; position: absolute; top: {{ $top_pos }}px; left: 0px; right: 0px'>{{ $thisHigh | toInt }}</p>
                            <p style='color: #F0F0F0; position: absolute; bottom: {{ $bot_pos }}px; left: 0px; right:0px'>{{ $thisLow | toInt }}</p>
                          </div>
                        </div>
                  {{ end }}
                </div>
              </div>

          - type: bookmarks
            title: Liens
            groups:
              - title: Quotidien
                color: 157 64 60
                links:
                  - title: YouTube
                    url: https://www.youtube.com
                    icon: si:youtube
                  - title: Reddit
                    url: https://www.reddit.com
                    icon: si:reddit
                  - title: Gmail
                    url: https://mail.google.com
                    icon: si:gmail
                  - title: Proton Mail
                    url: https://mail.proton.me
                    icon: si:protonmail
                  - title: Google Drive
                    url: https://drive.google.com
                    icon: si:googledrive
                  - title: Proton Drive
                    url: https://drive.proton.me
                    icon: si:protondrive
                  - title: Claude
                    url: https://claude.ai
                    icon: si:anthropic

              - title: Self-hosted
                color: 200 60 50
                links:
                  - title: fs0ciety.org
                    url: https://fs0ciety.org
                    icon: https://fs0ciety.org/logo.svg
                  - title: Blog
                    url: https://blog.fs0ciety.org
                    icon: si:ghost
                  - title: Immich
                    url: https://photos.fs0ciety.org
                    icon: sh:immich
                  - title: Pairdrop
                    url: https://drop.fs0ciety.org
                    icon: sh:pairdrop
                  - title: KitchenOwl
                    url: https://cook.fs0ciety.org
                    icon: sh:kitchenowl
                  - title: Paperless
                    url: https://docs.fs0ciety.org
                    icon: sh:paperless-ngx
                  - title: Gitea
                    url: https://git.fs0ciety.org
                    icon: si:gitea
                  - title: Documenso
                    url: https://sign.fs0ciety.org
                    icon: si:docusign
                  - title: Coolify
                    url: http://100.122.105.13
                    icon: sh:coolify
                  - title: Uptime Kuma
                    url: ${KUMA_URL}
                    icon: sh:uptime-kuma

              - title: Media
                color: 30 80 60
                links:
                  - title: Plex NiftyBee
                    url: ${PLEX_URL}
                    icon: si:plex
                  - title: Plex Citadel
                    url: ${PLEX2_URL}
                    icon: si:plex
                  - title: Sonarr
                    url: ${SONARR_URL}
                    icon: si:sonarr
                  - title: Radarr
                    url: ${RADARR_URL}
                    icon: si:radarr
                  - title: Jellyseerr
                    url: ${JELLYSEERR_URL}
                    icon: sh:jellyseerr
                  - title: qBittorrent
                    url: ${QBIT_URL}
                    icon: si:qbittorrent
                  - title: SABnzbd
                    url: ${SABNZBD_URL}
                    icon: sh:sabnzbd

          - type: custom-api
            title: NBA Scores
            cache: 15m
            url: https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard
            headers:
              Accept: application/json
            template: |
              {{ $events := .JSON.Array "events" }}
              {{ if eq (len $events) 0 }}
                <p class="size-h5 color-subdue" style="text-align:center;">No games today</p>
              {{ else }}
                {{ range $events }}
                  {{ $comp := index (.Array "competitions") 0 }}
                  {{ $home := index ($comp.Array "competitors") 0 }}
                  {{ $away := index ($comp.Array "competitors") 1 }}
                  {{ $status := $comp.String "status.type.shortDetail" }}
                  <div style="display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid var(--color-separator);">
                    <div style="display:flex; align-items:center; gap:8px;">
                      <img src="{{ $away.String "team.logo" }}" style="width:20px; height:20px;" />
                      <span class="size-h5">{{ $away.String "team.abbreviation" }}</span>
                    </div>
                    <span class="size-h4 color-highlight">{{ $away.String "score" }}</span>
                  </div>
                  <div style="display:flex; justify-content:space-between; align-items:center; padding:6px 0;">
                    <div style="display:flex; align-items:center; gap:8px;">
                      <img src="{{ $home.String "team.logo" }}" style="width:20px; height:20px;" />
                      <span class="size-h5">{{ $home.String "team.abbreviation" }}</span>
                    </div>
                    <span class="size-h4 color-highlight">{{ $home.String "score" }}</span>
                  </div>
                  <div style="text-align:center; padding-bottom:8px; border-bottom:1px solid var(--color-separator); margin-bottom:4px;">
                    <span class="size-h6 color-subdue">{{ $status }}</span>
                  </div>
                {{ end }}
              {{ end }}

          - type: custom-api
            title: Nearby Aircraft
            cache: 1m
            url: https://opensky-network.org/api/states/all?lamin=50.35&lomin=3.70&lamax=50.55&lomax=4.20
            template: |
              <div>
                {{ $states := .JSON.Array "states" }}
                {{ $statesCount := len $states }}
                <div class="margin-block-2">
                  <div class="size-h6">AIRCRAFT NEARBY: {{ $statesCount }}</div>
                </div>
                {{ if gt $statesCount 0 }}
                  {{ range $index, $plane := $states }}
                    {{ if lt $index 8 }}
                    {{ $callsign := $plane.String "1" }}
                    {{ $origin := $plane.String "2" }}
                    {{ $onGround := $plane.Bool "8" }}
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; padding:6px 0; border-top:{{ if eq $index 0 }}none{{ else }}1px solid var(--color-separator){{ end }};">
                      <div>
                        <div class="color-highlight size-h4">{{ if ne $callsign "" }}{{ $callsign }}{{ else }}-{{ end }}</div>
                        <div class="size-h6">CALLSIGN</div>
                      </div>
                      <div>
                        {{ $altitude := $plane.Float "7" }}
                        <div class="color-highlight size-h4">{{ if and (not $onGround) ($altitude | ne 0.0) }}{{ $altitude | printf "%.0f" }}m{{ else }}Ground{{ end }}</div>
                        <div class="size-h6">ALTITUDE</div>
                      </div>
                    </div>
                    {{ end }}
                  {{ end }}
                {{ end }}
              </div>

  # ============================================================
  #  HOMELAB
  # ============================================================
  - name: Homelab
    slug: homelab
    width: wide

    columns:
      - size: small
        widgets:
          - type: custom-api
            title: Portainer
            cache: 1h
            url: ${PORTAINER_URL}/api/endpoints/${PORTAINER_ENDPOINT_ID}
            headers:
              X-API-Key: ${PORTAINER_API_KEY}
            template: |
              <style>
                .list-horizontal-text.no-bullets > *:not(:last-child)::after {
                    content: none !important;
                }
                .list-horizontal-text.no-bullets > *:not(:last-child) {
                  margin-right: 1em;
                }
              </style>
              <div style="display:flex; align-items:center; gap:12px;">
                  <div style="width:40px; height:40px; flex-shrink:0; display:flex; justify-content:center; align-items:center; overflow:hidden;">
                    <img src="https://cdn.jsdelivr.net/gh/homarr-labs/dashboard-icons/svg/portainer-dark.svg" width="24" height="24" style="object-fit:contain;">
                  </div>
                  <div style="flex-grow:1; min-width:0;">
                    <a class="size-h4 block text-truncate color-highlight">
                      {{ .JSON.String "Name" }}
                      <span style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-positive); display: inline-block; vertical-align: middle;"></span>
                    </a>
                    <ul class="list-horizontal-text no-bullets">
                      <li data-popover-type="text" data-popover-text="Containers: {{ .JSON.Int "Snapshots.0.ContainerCount" }}">
                        <p style="display:inline-flex;align-items:center;">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="height:1em;vertical-align:middle;margin-right:0.5em;" class="size-6 lucide lucide-box icon inline-flex" aria-hidden="true" role="img"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path><path d="m3.3 7 8.7 5 8.7-5"></path><path d="M12 22V12"></path></svg>
                          {{ .JSON.Int "Snapshots.0.ContainerCount" }}
                        </p>
                      </li>
                      <li data-popover-type="text" data-popover-text="Volumes: {{ .JSON.Int "Snapshots.0.VolumeCount" }}">
                        <p style="display:inline-flex;align-items:center;">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="height:1em;vertical-align:middle;margin-right:0.5em;" class="size-6 lucide lucide-database icon inline-flex" aria-hidden="true" role="img"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M3 5V19A9 3 0 0 0 21 19V5"></path><path d="M3 12A9 3 0 0 0 21 12"></path></svg>
                          {{ .JSON.Int "Snapshots.0.VolumeCount"  }}
                        </p>
                      </li>
                      <li data-popover-type="text" data-popover-text="Networks: {{ .JSON.Int "Snapshots.0.DockerSnapshotRaw.Networks.#" }}">
                        <p style="display:inline-flex;align-items:center;">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="height:1em;vertical-align:middle;margin-right:0.5em;" class="size-6 lucide lucide-network icon inline-flex" aria-hidden="true" role="img"><rect x="16" y="16" width="6" height="6" rx="1"></rect><rect x="2" y="16" width="6" height="6" rx="1"></rect><rect x="9" y="2" width="6" height="6" rx="1"></rect><path d="M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"></path><path d="M12 12V8"></path></svg>
                          {{ .JSON.Int "Snapshots.0.DockerSnapshotRaw.Networks.#" }}
                        </p>
                      </li>
                    </ul>
                  </div>
              </div>
              <div class="margin-block-2" style="margin-top: 1em">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                  <div>
                    <div class="size-h5">Running</div>
                    <div class="size-h3 color-highlight">{{ .JSON.Int "Snapshots.0.RunningContainerCount" }}</div>
                  </div>
                  <div>
                    <div class="size-h5">Healthy</div>
                    <div class="size-h3 color-highlight">{{ .JSON.Int "Snapshots.0.HealthyContainerCount" }}</div>
                  </div>
                  <div>
                    <div class="size-h5">Stopped</div>
                    <div class="size-h3 color-highlight">{{ .JSON.Int "Snapshots.0.StoppedContainerCount" }}</div>
                  </div>
                  <div>
                    <div class="size-h5">Unhealthy</div>
                    <div class="size-h3 color-highlight">{{ .JSON.Int "Snapshots.0.DockerSnapshotRaw.Containers.#(Health=\"unhealthy\").#" }}</div>
                  </div>
                </div>
              </div>

      - size: full
        widgets:
          - type: custom-api
            title: Uptime Kuma
            title-url: ${UPTIME_KUMA_URL}
            url: ${UPTIME_KUMA_URL}/api/status-page/${UPTIME_KUMA_STATUS_SLUG}
            subrequests:
              heartbeats:
                url: ${UPTIME_KUMA_URL}/api/status-page/heartbeat/${UPTIME_KUMA_STATUS_SLUG}
            cache: 10m
            template: |
              {{ $hb := .Subrequest "heartbeats" }}
              {{ if not (.JSON.Exists "publicGroupList") }}
              <p class="color-negative">Error reading response</p>
              {{ else if eq (len (.JSON.Array "publicGroupList")) 0 }}
              <p>No monitors found</p>
              {{ else }}
              <ul class="dynamic-columns list-gap-8">
                {{ range .JSON.Array "publicGroupList" }}
                {{ range .Array "monitorList" }}
                {{ $id := .String "id" }}
                {{ $hbArray := $hb.JSON.Array (print "heartbeatList." $id) }}
                <div class="flex items-center gap-12">
                  <a class="size-title-dynamic color-highlight text-truncate block grow" href="${UPTIME_KUMA_URL}/dashboard/{{ $id }}"
                    target="_blank" rel="noreferrer">
                    {{ .String "name" }} </a>
                  {{ if gt (len $hbArray) 0 }}
                    {{ $latest := index $hbArray (sub (len $hbArray) 1) }}
                    {{ if eq ($latest.Int "status") 1 }}
                    <div>{{ $latest.Int "ping" }}ms</div>
                    <div class="monitor-site-status-icon-compact" title="OK">
                      <svg fill="var(--color-positive)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                          d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z"
                          clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    {{ else }}
                    <div><span class="color-negative">DOWN</span></div>
                    <div class="monitor-site-status-icon-compact" title="{{ if $latest.Exists "msg" }}{{ $latest.String "msg" }}{{ else }}Error{{ end }}">
                      <svg fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                          d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"
                          clip-rule="evenodd"></path>
                      </svg>
                    </div>
                    {{ end }}
                  {{ else }}
                    <div><span class="color-negative">No data</span></div>
                    <div class="monitor-site-status-icon-compact" title="No data available">
                      <svg fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm0-2a6 6 0 1 0 0-12 6 6 0 0 0 0 12zm-.75-8a.75.75 0 0 1 1.5 0v3a.75.75 0 0 1-1.5 0V8zm.75 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                      </svg>
                    </div>
                  {{ end }}
                </div>
                {{ end }}
                {{ end }}
              </ul>
              {{ end }}

          - type: monitor
            title: Services
            cache: 5m
            sites:
              - title: Immich
                url: ${IMMICH_URL}
                icon: sh:immich
              - title: Pairdrop
                url: https://drop.fs0ciety.org
                icon: sh:pairdrop
              - title: KitchenOwl
                url: https://cook.fs0ciety.org
                icon: sh:kitchenowl
              - title: Paperless
                url: https://docs.fs0ciety.org
                icon: sh:paperless-ngx
              - title: Gitea
                url: https://git.fs0ciety.org
                icon: si:gitea
              - title: Mazanoke
                url: https://img.fs0ciety.org
                icon: sh:mazanoke
              - title: Termix
                url: https://termix.fs0ciety.org
                icon: si:gnometerminal
              - title: Your Spotify
                url: https://spotify.fs0ciety.org
                icon: si:spotify
              - title: Documenso
                url: https://sign.fs0ciety.org
                icon: si:docusign
              - title: Bento PDF
                url: ${BENTO_PDF_URL}
                icon: si:adobeacrobatreader
              - title: Uptime Kuma
                url: ${KUMA_URL}
                icon: sh:uptime-kuma

  # ============================================================
  #  MEDIA
  # ============================================================
  - name: Media
    slug: media
    width: wide

    columns:
      # ── Plex NiftyBee ──────────────────────────────────────────
      - size: full
        widgets:
          - type: custom-api
            title: Plex NiftyBee - En cours
            title-url: ${PLEX_URL}/web
            cache: 1m
            options:
              media-server: "plex"
              base-url: ${PLEX_URL}
              api-key: ${PLEX_TOKEN}
              small-column: false
              compact: true
              play-state: "indicator"
              show-thumbnail: true
              full-thumbnail: false
              show-paused: true
              show-progress-bar: true
              show-progress-info: true
              time-format: "15:04"
            template: |
              {{ $mediaServer := .Options.StringOr "media-server" "" }}
              {{ $baseURL := .Options.StringOr "base-url" "" }}
              {{ $apiKey := .Options.StringOr "api-key" "" }}
              {{ define "errorMsg" }}
                <div class="widget-error-header">
                  <div class="color-negative size-h3">ERROR</div>
                </div>
                <p class="break-all">{{ . }}</p>
              {{ end }}
              {{ if or (eq $mediaServer "") (eq $baseURL "") (eq $apiKey "") }}
                {{ template "errorMsg" "Options manquantes" }}
              {{ else }}
              {{ $isSmallColumn := .Options.BoolOr "small-column" false }}
              {{ $isCompact := .Options.BoolOr "compact" true }}
              {{ $playState := .Options.StringOr "play-state" "indicator" }}
              {{ $showThumbnail := .Options.BoolOr "show-thumbnail" false }}
              {{ $fullThumbnail := .Options.BoolOr "full-thumbnail" false }}
              {{ $showPaused := .Options.BoolOr "show-paused" false }}
              {{ $showProgressBar := .Options.BoolOr "show-progress-bar" false }}
              {{ $showProgressInfo := .Options.BoolOr "show-progress-info" true }}
              {{ $timeFormat := .Options.StringOr "time-format" "15:04" }}
              {{ $sessionsRequestURL := concat $baseURL "/status/sessions" }}
              {{ $sessionsCall := newRequest $sessionsRequestURL
                | withHeader "Accept" "application/json"
                | withHeader "X-Plex-Token" $apiKey
                | getResponse }}
              {{ $sessions := "" }}
              {{ $activeSessions := 0 }}
              {{ if $sessionsCall.JSON.Exists "MediaContainer" }}
                {{ $sessions = $sessionsCall.JSON.Array "MediaContainer.Metadata" }}
                {{ $activeSessions = len $sessions }}
              {{ end }}
              {{ if eq $activeSessions 0 }}
                <p>Rien en lecture actuellement.</p>
              {{ else }}
                <style>
                  .media-server-session-container--grid { display: grid; grid-template-columns: repeat(2, 1fr); }
                  @media (max-width: 768px) { .media-server-session-container--grid { display: flex; flex-direction: column; } }
                  .media-server-progress-container { height: 1rem; max-width: 32rem; border: 1px solid var(--color-text-base); border-radius: var(--border-radius); overflow: hidden; }
                  .media-server-progress-bar { height: 100%; background: var(--color-primary); border-radius: 3px; transition: width 1s linear; }
                  @keyframes progress-animation { to { width: 100%; } }
                </style>
                <div class="gap-10 {{ if $isSmallColumn }}flex flex-column{{ else }}media-server-session-container--grid{{ end }}">
                {{ range $i, $session := $sessions }}
                  {{ $isPlaying := eq ($session.String "Player.state") "playing" }}
                  {{ $state := "playing" }}
                  {{ if not $isPlaying }}{{ $state = "paused" }}{{ end }}
                  {{ $mediaType := $session.String "type" }}
                  {{ $isMovie := eq $mediaType "movie" }}
                  {{ $isShows := eq $mediaType "episode" }}
                  {{ $isMusic := eq $mediaType "track" }}
                  {{ $userName := $session.String "User.title" }}
                  {{ $title := $session.String "title" }}
                  {{ $showTitle := $session.String "grandparentTitle" }}
                  {{ $showSeason := $session.String "parentIndex" }}
                  {{ $showEpisode := $session.String "index" }}
                  {{ $artist := $session.String "grandparentTitle" }}
                  {{ $albumTitle := $session.String "parentTitle" }}
                  {{ $thumbID := $session.String "thumb" }}
                  {{ if or $isShows $isMusic }}
                    {{ $thumbID = $session.String "parentThumb" }}
                  {{ end }}
                  {{ $thumbURL := concat $baseURL $thumbID "?X-Plex-Token=" $apiKey }}
                  {{ $now := now | formatTime "15:04:05" | parseLocalTime "15:04:05" }}
                  {{ $duration := $session.Float "duration" }}
                  {{ $offset := $session.Float "viewOffset" }}
                  {{ $remainingSeconds := div (sub $duration $offset) 1000 | toInt }}
                  {{ $progress := mul 100 (div $offset $duration) | toInt }}
                  {{ $endTime := $now.Add (duration (printf "%ds" $remainingSeconds)) | formatTime $timeFormat }}
                  {{ if or $isPlaying $showPaused }}
                  <div class="card gap-5">
                    <div class="flex items-center gap-10 size-h3">
                      <span class="color-primary">{{ $userName }}</span>
                      {{ if eq $playState "indicator" }}
                        <style>
                          .media-server-indicator { height: .7rem; width: .7rem; border-radius: 100%;
                            {{ if $isPlaying }} animation: pulse 5s infinite; background: var(--color-primary);
                            {{ else }} background: var(--color-text-base-muted); {{ end }} }
                          @keyframes pulse { 0% { box-shadow: 0 0 0 0 var(--color-text-base); } 40% { box-shadow: 0 0 0 4px transparent; } 100% { box-shadow: 0 0 0 4px transparent; } }
                        </style>
                        <div class="media-server-indicator"></div>
                      {{ else }}
                        <span {{ if $isPlaying }}class="color-primary"{{ end }}>[{{ $state }}]</span>
                      {{ end }}
                    </div>
                    <hr class="margin-bottom-5" />
                    <div class="flex items-center gap-10" style="align-items: stretch;">
                      {{ if $showThumbnail }}
                        <img src="{{ $thumbURL | safeURL }}" alt="{{ $title }}" class="shrink-0" loading="lazy" style="max-width: 7.5rem; border: 2px solid var(--color-primary); border-radius: var(--border-radius); object-fit: cover; {{ if and $isCompact (not $fullThumbnail) }}aspect-ratio: 1;{{ end }}" />
                      {{ end }}
                      <ul class="flex flex-column grow justify-evenly" style="width: 0;">
                        {{ if $isCompact }}
                          {{ if $isShows }}
                            <ul class="list-horizontal-text flex-nowrap">
                              <li class="shrink-0">{{ concat "S" $showSeason "E" $showEpisode }}</li>
                              <li class="text-truncate">{{ $showTitle }}</li>
                            </ul>
                          {{ else if $isMusic }}
                            <ul class="list-horizontal-text flex-nowrap">
                              <li class="shrink-0">{{ $artist }}</li>
                              <li class="text-truncate">{{ $albumTitle }}</li>
                            </ul>
                          {{ end }}
                          <li class="text-truncate">{{ $title }}</li>
                        {{ else }}
                          {{ if $isShows }}<li>{{ $showTitle }}</li><li>{{ concat "S" $showSeason "E" $showEpisode }}</li>
                          {{ else if $isMusic }}<li>{{ $artist }}</li><li>{{ $albumTitle }}</li>{{ end }}
                          <li>{{ $title }}</li>
                        {{ end }}
                        <li>
                          {{ if and $isPlaying $showProgressBar }}
                            <div class="flex gap-10 items-center">
                              <div class="media-server-progress-container grow">
                                <div class="media-server-progress-bar" style="width: {{ $progress }}%; animation: progress-animation {{ $remainingSeconds }}s linear forwards;"></div>
                              </div>
                              {{ if $showProgressInfo }}<p>{{ $endTime }}</p>{{ end }}
                            </div>
                          {{ end }}
                        </li>
                      </ul>
                    </div>
                  </div>
                  {{ end }}
                {{ end }}
              </div>
              {{ end }}
              {{ end }}

          - type: custom-api
            title: Plex NiftyBee - Historique
            title-url: ${PLEX_URL}/web
            frameless: true
            cache: 5m
            options:
              media-server: "plex"
              base-url: ${PLEX_URL}
              api-key: ${PLEX_TOKEN}
              history-length: "12"
              small-column: false
              compact: true
              show-thumbnail: true
              thumbnail-aspect-ratio: "portrait"
              show-user: true
              time-absolute: false
              time-format: "Jan 02 15:04"
            template: |
              {{ $baseURL := .Options.StringOr "base-url" "" }}
              {{ $apiKey := .Options.StringOr "api-key" "" }}
              {{ if or (eq $baseURL "") (eq $apiKey "") }}
                <p class="color-negative">Options manquantes</p>
              {{ else }}
              {{ $historyLength := .Options.StringOr "history-length" "10" }}
              {{ $isCompact := .Options.BoolOr "compact" true }}
              {{ $showThumbnail := .Options.BoolOr "show-thumbnail" false }}
              {{ $thumbAspectRatio := .Options.StringOr "thumbnail-aspect-ratio" "" }}
              {{ $showUser := .Options.BoolOr "show-user" true }}
              {{ $timeAbsolute := .Options.BoolOr "time-absolute" false }}
              {{ $timeFormat := .Options.StringOr "time-format" "Jan 02 15:04" }}
              {{ $historyCall := newRequest (concat $baseURL "/status/sessions/history/all")
                | withParameter "limit" $historyLength
                | withParameter "sort" "viewedAt:desc"
                | withHeader "Accept" "application/json"
                | withHeader "X-Plex-Token" $apiKey
                | getResponse }}
              {{ $history := "" }}
              {{ if $historyCall.JSON.Exists "MediaContainer" }}
                {{ $history = $historyCall.JSON.Array "MediaContainer.Metadata" }}
              {{ end }}
              {{ $usersCall := newRequest (concat $baseURL "/accounts")
                | withHeader "Accept" "application/json"
                | withHeader "X-Plex-Token" $apiKey
                | getResponse }}
              {{ $users := $usersCall.JSON.Array "MediaContainer.Account" }}
              {{ if eq (len $history) 0 }}
                <p>Aucun historique disponible.</p>
              {{ else }}
                <div class="carousel-container show-right-cutoff">
                  <div class="cards-horizontal carousel-items-container">
                    {{ range $n, $item := $history }}
                      {{ $userName := "" }}
                      {{ $userID := $item.Int "accountID" }}
                      {{ range $u := $users }}
                        {{ if eq $userID ($u.Int "id") }}{{ $userName = $u.String "name" }}{{ break }}{{ end }}
                      {{ end }}
                      {{ $mediaType := $item.String "type" }}
                      {{ $isShows := eq $mediaType "episode" }}
                      {{ $isMusic := eq $mediaType "track" }}
                      {{ $title := $item.String "title" }}
                      {{ $showTitle := "" }}{{ $showSeason := "" }}{{ $showEpisode := "" }}
                      {{ $artist := "" }}{{ $albumTitle := "" }}
                      {{ if $isShows }}
                        {{ $showTitle = $item.String "grandparentTitle" }}
                        {{ $showSeason = $item.String "parentIndex" }}
                        {{ $showEpisode = $item.String "index" }}
                      {{ else if $isMusic }}
                        {{ $artist = $item.String "grandparentTitle" }}
                        {{ $albumTitle = $item.String "parentTitle" }}
                      {{ end }}
                      {{ $thumbID := $item.String "thumb" }}
                      {{ if or $isShows $isMusic }}{{ $thumbID = $item.String "parentThumb" }}{{ end }}
                      {{ $thumbURL := concat $baseURL $thumbID "?X-Plex-Token=" $apiKey }}
                      {{ $time := $item.String "viewedAt" }}
                      {{ $playedAt := "" }}
                      {{ if $timeAbsolute }}
                        {{ $playedAt = $time | parseLocalTime "unix" | formatTime $timeFormat }}
                      {{ else }}
                        {{ $playedAt = $time | parseRelativeTime "unix" }}
                      {{ end }}
                      <div class="card widget-content-frame">
                        {{ if $showThumbnail }}
                          <img src="{{ $thumbURL | safeURL }}" alt="{{ $title }}" loading="lazy" class="shrink-0" style="object-fit: cover; border-radius: var(--border-radius) var(--border-radius) 0 0; {{ if eq $thumbAspectRatio "square" }}aspect-ratio: 1;{{ else if eq $thumbAspectRatio "portrait" }}aspect-ratio: 3/4;{{ else if eq $thumbAspectRatio "landscape" }}aspect-ratio: 4/3;{{ else }}aspect-ratio: initial;{{ end }}" />
                        {{ end }}
                        <div class="grow padding-inline-widget margin-top-10 margin-bottom-10">
                          <ul class="flex flex-column justify-evenly margin-bottom-3" style="height: 100%;">
                            <ul class="list-horizontal-text flex-nowrap">
                              {{ if $showUser }}<li class="color-primary text-truncate">{{ $userName }}</li>{{ end }}
                              {{ if $timeAbsolute }}
                                <li class="text-truncate">{{ $playedAt }}</li>
                              {{ else }}
                                <li class="shrink-0"><span {{ $playedAt }}></span></li>
                              {{ end }}
                            </ul>
                            {{ if $isShows }}
                              <ul class="list-horizontal-text flex-nowrap">
                                <li class="text-truncate">{{ concat "S" $showSeason "E" $showEpisode }}</li>
                                <li class="text-truncate">{{ $showTitle }}</li>
                              </ul>
                            {{ else if $isMusic }}
                              <ul class="list-horizontal-text flex-nowrap">
                                <li class="text-truncate">{{ $artist }}</li>
                                <li class="text-truncate">{{ $albumTitle }}</li>
                              </ul>
                            {{ end }}
                            <li class="text-truncate">{{ $title }}</li>
                          </ul>
                        </div>
                      </div>
                    {{ end }}
                  </div>
                </div>
              {{ end }}
              {{ end }}

      # ── Plex Citadel ───────────────────────────────────────────
          - type: custom-api
            title: Plex Citadel - En cours
            title-url: ${PLEX2_URL}/web
            cache: 1m
            options:
              media-server: "plex"
              base-url: ${PLEX2_URL}
              api-key: ${PLEX2_TOKEN}
              small-column: false
              compact: true
              play-state: "indicator"
              show-thumbnail: true
              full-thumbnail: false
              show-paused: true
              show-progress-bar: true
              show-progress-info: true
              time-format: "15:04"
            template: |
              {{ $mediaServer := .Options.StringOr "media-server" "" }}
              {{ $baseURL := .Options.StringOr "base-url" "" }}
              {{ $apiKey := .Options.StringOr "api-key" "" }}
              {{ if or (eq $mediaServer "") (eq $baseURL "") (eq $apiKey "") }}
                <p class="color-negative">Options manquantes</p>
              {{ else }}
              {{ $isSmallColumn := .Options.BoolOr "small-column" false }}
              {{ $isCompact := .Options.BoolOr "compact" true }}
              {{ $playState := .Options.StringOr "play-state" "indicator" }}
              {{ $showThumbnail := .Options.BoolOr "show-thumbnail" false }}
              {{ $fullThumbnail := .Options.BoolOr "full-thumbnail" false }}
              {{ $showPaused := .Options.BoolOr "show-paused" false }}
              {{ $showProgressBar := .Options.BoolOr "show-progress-bar" false }}
              {{ $showProgressInfo := .Options.BoolOr "show-progress-info" true }}
              {{ $timeFormat := .Options.StringOr "time-format" "15:04" }}
              {{ $sessionsRequestURL := concat $baseURL "/status/sessions" }}
              {{ $sessionsCall := newRequest $sessionsRequestURL
                | withHeader "Accept" "application/json"
                | withHeader "X-Plex-Token" $apiKey
                | getResponse }}
              {{ $sessions := "" }}
              {{ $activeSessions := 0 }}
              {{ if $sessionsCall.JSON.Exists "MediaContainer" }}
                {{ $sessions = $sessionsCall.JSON.Array "MediaContainer.Metadata" }}
                {{ $activeSessions = len $sessions }}
              {{ end }}
              {{ if eq $activeSessions 0 }}
                <p>Rien en lecture actuellement.</p>
              {{ else }}
                <style>
                  .media-server-session-container--grid { display: grid; grid-template-columns: repeat(2, 1fr); }
                  @media (max-width: 768px) { .media-server-session-container--grid { display: flex; flex-direction: column; } }
                  .media-server-progress-container { height: 1rem; max-width: 32rem; border: 1px solid var(--color-text-base); border-radius: var(--border-radius); overflow: hidden; }
                  .media-server-progress-bar { height: 100%; background: var(--color-primary); border-radius: 3px; transition: width 1s linear; }
                  @keyframes progress-animation { to { width: 100%; } }
                </style>
                <div class="gap-10 {{ if $isSmallColumn }}flex flex-column{{ else }}media-server-session-container--grid{{ end }}">
                {{ range $i, $session := $sessions }}
                  {{ $isPlaying := eq ($session.String "Player.state") "playing" }}
                  {{ $state := "playing" }}
                  {{ if not $isPlaying }}{{ $state = "paused" }}{{ end }}
                  {{ $mediaType := $session.String "type" }}
                  {{ $isMovie := eq $mediaType "movie" }}
                  {{ $isShows := eq $mediaType "episode" }}
                  {{ $isMusic := eq $mediaType "track" }}
                  {{ $userName := $session.String "User.title" }}
                  {{ $title := $session.String "title" }}
                  {{ $showTitle := $session.String "grandparentTitle" }}
                  {{ $showSeason := $session.String "parentIndex" }}
                  {{ $showEpisode := $session.String "index" }}
                  {{ $artist := $session.String "grandparentTitle" }}
                  {{ $albumTitle := $session.String "parentTitle" }}
                  {{ $thumbID := $session.String "thumb" }}
                  {{ if or $isShows $isMusic }}
                    {{ $thumbID = $session.String "parentThumb" }}
                  {{ end }}
                  {{ $thumbURL := concat $baseURL $thumbID "?X-Plex-Token=" $apiKey }}
                  {{ $now := now | formatTime "15:04:05" | parseLocalTime "15:04:05" }}
                  {{ $duration := $session.Float "duration" }}
                  {{ $offset := $session.Float "viewOffset" }}
                  {{ $remainingSeconds := div (sub $duration $offset) 1000 | toInt }}
                  {{ $progress := mul 100 (div $offset $duration) | toInt }}
                  {{ $endTime := $now.Add (duration (printf "%ds" $remainingSeconds)) | formatTime $timeFormat }}
                  {{ if or $isPlaying $showPaused }}
                  <div class="card gap-5">
                    <div class="flex items-center gap-10 size-h3">
                      <span class="color-primary">{{ $userName }}</span>
                      {{ if eq $playState "indicator" }}
                        <style>
                          .media-server-indicator { height: .7rem; width: .7rem; border-radius: 100%;
                            {{ if $isPlaying }} animation: pulse 5s infinite; background: var(--color-primary);
                            {{ else }} background: var(--color-text-base-muted); {{ end }} }
                          @keyframes pulse { 0% { box-shadow: 0 0 0 0 var(--color-text-base); } 40% { box-shadow: 0 0 0 4px transparent; } 100% { box-shadow: 0 0 0 4px transparent; } }
                        </style>
                        <div class="media-server-indicator"></div>
                      {{ else }}
                        <span {{ if $isPlaying }}class="color-primary"{{ end }}>[{{ $state }}]</span>
                      {{ end }}
                    </div>
                    <hr class="margin-bottom-5" />
                    <div class="flex items-center gap-10" style="align-items: stretch;">
                      {{ if $showThumbnail }}
                        <img src="{{ $thumbURL | safeURL }}" alt="{{ $title }}" class="shrink-0" loading="lazy" style="max-width: 7.5rem; border: 2px solid var(--color-primary); border-radius: var(--border-radius); object-fit: cover; {{ if and $isCompact (not $fullThumbnail) }}aspect-ratio: 1;{{ end }}" />
                      {{ end }}
                      <ul class="flex flex-column grow justify-evenly" style="width: 0;">
                        {{ if $isCompact }}
                          {{ if $isShows }}
                            <ul class="list-horizontal-text flex-nowrap">
                              <li class="shrink-0">{{ concat "S" $showSeason "E" $showEpisode }}</li>
                              <li class="text-truncate">{{ $showTitle }}</li>
                            </ul>
                          {{ else if $isMusic }}
                            <ul class="list-horizontal-text flex-nowrap">
                              <li class="shrink-0">{{ $artist }}</li>
                              <li class="text-truncate">{{ $albumTitle }}</li>
                            </ul>
                          {{ end }}
                          <li class="text-truncate">{{ $title }}</li>
                        {{ else }}
                          {{ if $isShows }}<li>{{ $showTitle }}</li><li>{{ concat "S" $showSeason "E" $showEpisode }}</li>
                          {{ else if $isMusic }}<li>{{ $artist }}</li><li>{{ $albumTitle }}</li>{{ end }}
                          <li>{{ $title }}</li>
                        {{ end }}
                        <li>
                          {{ if and $isPlaying $showProgressBar }}
                            <div class="flex gap-10 items-center">
                              <div class="media-server-progress-container grow">
                                <div class="media-server-progress-bar" style="width: {{ $progress }}%; animation: progress-animation {{ $remainingSeconds }}s linear forwards;"></div>
                              </div>
                              {{ if $showProgressInfo }}<p>{{ $endTime }}</p>{{ end }}
                            </div>
                          {{ end }}
                        </li>
                      </ul>
                    </div>
                  </div>
                  {{ end }}
                {{ end }}
              </div>
              {{ end }}
              {{ end }}

          - type: custom-api
            title: Plex Citadel - Historique
            title-url: ${PLEX2_URL}/web
            frameless: true
            cache: 5m
            options:
              media-server: "plex"
              base-url: ${PLEX2_URL}
              api-key: ${PLEX2_TOKEN}
              history-length: "12"
              small-column: false
              compact: true
              show-thumbnail: true
              thumbnail-aspect-ratio: "portrait"
              show-user: true
              time-absolute: false
              time-format: "Jan 02 15:04"
            template: |
              {{ $baseURL := .Options.StringOr "base-url" "" }}
              {{ $apiKey := .Options.StringOr "api-key" "" }}
              {{ if or (eq $baseURL "") (eq $apiKey "") }}
                <p class="color-negative">Options manquantes</p>
              {{ else }}
              {{ $historyLength := .Options.StringOr "history-length" "10" }}
              {{ $isCompact := .Options.BoolOr "compact" true }}
              {{ $showThumbnail := .Options.BoolOr "show-thumbnail" false }}
              {{ $thumbAspectRatio := .Options.StringOr "thumbnail-aspect-ratio" "" }}
              {{ $showUser := .Options.BoolOr "show-user" true }}
              {{ $timeAbsolute := .Options.BoolOr "time-absolute" false }}
              {{ $timeFormat := .Options.StringOr "time-format" "Jan 02 15:04" }}
              {{ $historyCall := newRequest (concat $baseURL "/status/sessions/history/all")
                | withParameter "limit" $historyLength
                | withParameter "sort" "viewedAt:desc"
                | withHeader "Accept" "application/json"
                | withHeader "X-Plex-Token" $apiKey
                | getResponse }}
              {{ $history := "" }}
              {{ if $historyCall.JSON.Exists "MediaContainer" }}
                {{ $history = $historyCall.JSON.Array "MediaContainer.Metadata" }}
              {{ end }}
              {{ $usersCall := newRequest (concat $baseURL "/accounts")
                | withHeader "Accept" "application/json"
                | withHeader "X-Plex-Token" $apiKey
                | getResponse }}
              {{ $users := $usersCall.JSON.Array "MediaContainer.Account" }}
              {{ if eq (len $history) 0 }}
                <p>Aucun historique disponible.</p>
              {{ else }}
                <div class="carousel-container show-right-cutoff">
                  <div class="cards-horizontal carousel-items-container">
                    {{ range $n, $item := $history }}
                      {{ $userName := "" }}
                      {{ $userID := $item.Int "accountID" }}
                      {{ range $u := $users }}
                        {{ if eq $userID ($u.Int "id") }}{{ $userName = $u.String "name" }}{{ break }}{{ end }}
                      {{ end }}
                      {{ $mediaType := $item.String "type" }}
                      {{ $isShows := eq $mediaType "episode" }}
                      {{ $isMusic := eq $mediaType "track" }}
                      {{ $title := $item.String "title" }}
                      {{ $showTitle := "" }}{{ $showSeason := "" }}{{ $showEpisode := "" }}
                      {{ $artist := "" }}{{ $albumTitle := "" }}
                      {{ if $isShows }}
                        {{ $showTitle = $item.String "grandparentTitle" }}
                        {{ $showSeason = $item.String "parentIndex" }}
                        {{ $showEpisode = $item.String "index" }}
                      {{ else if $isMusic }}
                        {{ $artist = $item.String "grandparentTitle" }}
                        {{ $albumTitle = $item.String "parentTitle" }}
                      {{ end }}
                      {{ $thumbID := $item.String "thumb" }}
                      {{ if or $isShows $isMusic }}{{ $thumbID = $item.String "parentThumb" }}{{ end }}
                      {{ $thumbURL := concat $baseURL $thumbID "?X-Plex-Token=" $apiKey }}
                      {{ $time := $item.String "viewedAt" }}
                      {{ $playedAt := "" }}
                      {{ if $timeAbsolute }}
                        {{ $playedAt = $time | parseLocalTime "unix" | formatTime $timeFormat }}
                      {{ else }}
                        {{ $playedAt = $time | parseRelativeTime "unix" }}
                      {{ end }}
                      <div class="card widget-content-frame">
                        {{ if $showThumbnail }}
                          <img src="{{ $thumbURL | safeURL }}" alt="{{ $title }}" loading="lazy" class="shrink-0" style="object-fit: cover; border-radius: var(--border-radius) var(--border-radius) 0 0; {{ if eq $thumbAspectRatio "square" }}aspect-ratio: 1;{{ else if eq $thumbAspectRatio "portrait" }}aspect-ratio: 3/4;{{ else if eq $thumbAspectRatio "landscape" }}aspect-ratio: 4/3;{{ else }}aspect-ratio: initial;{{ end }}" />
                        {{ end }}
                        <div class="grow padding-inline-widget margin-top-10 margin-bottom-10">
                          <ul class="flex flex-column justify-evenly margin-bottom-3" style="height: 100%;">
                            <ul class="list-horizontal-text flex-nowrap">
                              {{ if $showUser }}<li class="color-primary text-truncate">{{ $userName }}</li>{{ end }}
                              {{ if $timeAbsolute }}
                                <li class="text-truncate">{{ $playedAt }}</li>
                              {{ else }}
                                <li class="shrink-0"><span {{ $playedAt }}></span></li>
                              {{ end }}
                            </ul>
                            {{ if $isShows }}
                              <ul class="list-horizontal-text flex-nowrap">
                                <li class="text-truncate">{{ concat "S" $showSeason "E" $showEpisode }}</li>
                                <li class="text-truncate">{{ $showTitle }}</li>
                              </ul>
                            {{ else if $isMusic }}
                              <ul class="list-horizontal-text flex-nowrap">
                                <li class="text-truncate">{{ $artist }}</li>
                                <li class="text-truncate">{{ $albumTitle }}</li>
                              </ul>
                            {{ end }}
                            <li class="text-truncate">{{ $title }}</li>
                          </ul>
                        </div>
                      </div>
                    {{ end }}
                  </div>
                </div>
              {{ end }}
              {{ end }}

      # ── Right: Sonarr / Radarr / Jellyseerr ──────────────────
      - size: full
        widgets:
          - type: group
            widgets:
              - type: custom-api
                title: "Sonarr - A venir"
                title-url: ${SONARR_URL}
                cache: 30m
                options:
                  service: sonarr
                  type: upcoming
                  size: medium
                  collapse-after: 5
                  show-grabbed: true
                  interval: 30
                  sort-time: asc
                  api-base-url: ${SONARR_API_URL}
                  key: ${SONARR_KEY}
                  url: ${SONARR_URL}
                template: |
                  {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
                  {{ $showGrabbed := .Options.BoolOr "show-grabbed" false }}
                  {{ $sortTime := .Options.StringOr "sort-time" "desc" }}
                  {{ $coverProxy := .Options.StringOr "cover-proxy" "" }}
                  {{ $size := .Options.StringOr "size" "medium" }}
                  {{ $service := .Options.StringOr "service" "" }}
                  {{ $type := .Options.StringOr "type" "" }}
                  {{ $intervalH := .Options.IntOr "interval" 0 | mul 24 }}

                  {{ $now := now | formatTime "2006-01-02T15:04:05" }}
                  {{ $posInterval := (offsetNow (printf "+%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}
                  {{ $negInterval := (offsetNow (printf "-%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}

                  {{ $apiBaseUrl := .Options.StringOr "api-base-url" "" }}
                  {{ $key := .Options.StringOr "key" "" }}
                  {{ $url := .Options.StringOr "url" $apiBaseUrl }}

                  {{ if or (and (ne $service "sonarr") (ne $service "radarr") (ne $service "lidarr"))
                           (and (ne $type "upcoming") (ne $type "recent") (ne $type "missing"))
                           (eq $apiBaseUrl "") (eq $key "") (eq $url "") }}
                    <div class="widget-error-header">
                        <div class="color-negative size-h3">ERROR</div>
                        <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                        </svg>
                      </div>
                      <p class="break-all">
                        Some options are not set or malformed
                          <table style="border-spacing: 1rem;">
                            <tr><td>service</td><td>{{ $service }}</td><td>must be sonarr, radarr, or lidarr</td></tr>
                            <tr><td>type</td><td>{{ $type }}</td><td>must be upcoming, recent, or missing</td></tr>
                            <tr><td>api-base-url</td><td>{{ $apiBaseUrl }}</td><td>should include http(s):// and port if needed</td></tr>
                            <tr><td>key</td><td>{{ $key }}</td><td></td></tr>
                          </table>
                      </p>
                  {{ else }}
                    {{ $requestUrl := "" }}

                    {{ if eq $service "sonarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeSeries=true&includeEpisode=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50&includeSeries=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?includeSeries=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "radarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeMovie=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "lidarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v1/history/since?includeArtist=true&includeAlbum=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v1/wanted/missing?page=1&pageSize=50&includeArtist=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v1/calendar?includeArtist=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}
                    {{ end }}

                    {{ $data := newRequest $requestUrl
                      | withHeader "Accept" "application/json"
                      | withHeader "X-Api-Key" $key
                      | getResponse }}

                    <ul class="list list-gap-14 collapsible-container single-line-titles" data-collapse-after="{{ $collapseAfter }}">
                      {{ $array := "" }}
                      {{ $sortByField := "" }}
                      {{ $itemDisplayed := false }}
                      {{ $itemDate := "" }}
                      {{ $isAvailable := false }}

                      {{ if eq $type "missing" }}
                        {{ $array = "records" }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ else if eq $type "recent" }}
                        {{ $sortByField = "date" }}
                      {{ else }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ end }}

                      {{ range $data.JSON.Array $array | sortByTime $sortByField "rfc3339" $sortTime }}

                        {{ if eq $service "sonarr" }}
                          {{ $itemDate = .String "airDateUtc" | parseTime "RFC3339" }}
                          {{ $itemDate = $itemDate.In now.Location | formatTime "2006-01-02T15:04:05" }}
                          {{ $isAvailable = true }}
                        {{ else if eq $service "radarr"}}
                          {{ $isAvailable = .Bool "isAvailable" }}
                          {{ $itemDate = .String "releaseDate" }}
                        {{ else if eq $service "lidarr"}}
                          {{ $itemDate = .String "releaseDate" }}
                          {{ $isAvailable = true }}
                        {{ end }}

                        {{ if or (eq $type "upcoming") (eq $type "recent") (and (or (and (gt $itemDate $negInterval) ((lt $itemDate $now ))) (eq $intervalH 0))  $isAvailable) }}
                          {{ $itemDisplayed = true }}
                          {{ $title := "" }}
                          {{ $subtitle := "" }}
                          {{ $coverUrl := "" }}
                          {{ $status := "" }}
                          {{ $coverBase := "" }}
                          {{ $height := "" }}
                          {{ $width := "" }}
                          {{ $popoverTitle := "" }}
                          {{ $popoverSubtitle := "" }}
                          {{ $popoverSummary := "" }}
                          {{ $summary := "" }}
                          {{ $link := "" }}
                          {{ $grabbed := false }}
                          {{ $date := now }}
                          {{ $datetype := "" }}
                          {{ $seString := "" }}
                          {{ $genres := "" }}
                          {{ $buttonJustify := "left" }}


                          {{ if eq $service "sonarr" }}
                            {{ $series := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "seriesId") $key }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "seriesId") }}
                            {{ end }}
                            {{ $title = .String "series.title" }}
                            {{ $link = printf "%s/series/%s#" $url (.String "series.titleSlug") }}
                            {{ $series = .Get "series" }}
                            {{ $genres = $series.Get "genres" }}

                            {{ if eq $type "recent" }}
                              {{ $date = .String "date" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "episode.title" }}
                              {{ $summary = .String "episode.overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "episode.seasonNumber") (.Int "episode.episodeNumber") }}
                              {{ $datetype = "Downloaded" }}

                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "episode.title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "episode.overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}

                            {{ else if eq $type "missing" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Aired" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ else if eq $type "upcoming" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Airs" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "radarr" }}
                            {{ $movie := "" }}
                            {{ $status = .String "status" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}
                            {{ if eq $status "announced"}}
                              {{ if ne (.String "inCinemas") "" }}
                                {{ $date = (.String "inCinemas" | parseTime "RFC3339") }}
                                {{ $datetype = "In Cinemas" }}
                              {{ else }}
                                {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                            {{ else if eq $status "inCinemas"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Releases" }}
                            {{ else if eq $status "released"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Released" }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "movie.id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "movie.id") }}
                              {{ end }}
                              {{ $datetype = "Downloaded" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $title = .String "movie.title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "movie.overview" }}
                              {{ $popoverTitle = .String "movie.title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "movie.overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "movie.titleSlug") }}
                              {{ $movie = .Get "movie" }}
                              {{ $genres = $movie.Get "genres" }}
                              {{ if and $showGrabbed (gt (.Int "movie.movieFileId") 0) }}
                                {{ $grabbed = true }}
                              {{ end }}
                            {{ else }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "id") }}
                              {{ end }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "titleSlug") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "overview" }}
                              {{ $genres = .Get "genres" }}
                              {{ if eq $type "missing" }}
                                {{ if and $showGrabbed (.Bool "movie.hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ if and $showGrabbed (.Bool "hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "lidarr" }}
                            {{ $artist := "" }}
                            {{ $album := "" }}
                            {{ $albumId := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v1/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ $album = .Get "album" }}
                              {{ $artist = $album.Get "artist" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase (.String "albumId") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase (.String "albumId") }}
                              {{ end }}
                              {{ $grabbed = true }}
                              {{ $title = $album.String "title" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $datetype = "Downloaded" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $summary = $album.String "overview" }}
                              {{ $popoverTitle = $album.String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = $artist.String "overview" }}

                            {{ else }}
                              {{ $artist = .Get "artist" }}
                              {{ $album = .Get "album" }}
                              {{ if eq $type "missing" }}
                                {{ $datetype = "Released" }}
                              {{ else }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                              {{ range .Array "releases" }}
                                {{ $albumId = .String "albumId" }}
                                {{ break }}
                              {{ end }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase $albumId $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase $albumId }}
                              {{ end }}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $summary = $album.String "overview" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "artist.overview" }}
                            {{ end }}
                          {{ end }}

                          {{ if eq $size "small" }}
                            {{ $buttonJustify = "right" }}
                            {{ $height = "9rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "9rem" }}
                            {{ else }}
                              {{ $width = "6rem" }}
                            {{ end }}
                          {{ else if eq $size "medium" }}
                            {{ $height = "12rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "12rem" }}
                            {{ else }}
                              {{ $width = "8rem" }}
                            {{ end }}
                          {{ else if eq $size "large" }}
                            {{ $height = "15rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "15rem" }}
                            {{ else }}
                              {{ $width = "10rem" }}
                            {{ end }}
                          {{ else if eq $size "huge" }}
                            {{ $height = "18rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "18rem" }}
                            {{ else }}
                              {{ $width = "12rem" }}
                            {{ end }}
                          {{ end }}

                          <li style="position: relative;">
                            <div class="flex gap-10 items-start thumbnail-container thumbnail-parent">
                              <div>
                                <div data-popover-type="html" data-popover-position="above" data-popover-show-delay="500" style="width: {{ $width  }}; height: {{ $height }}; align-content: center;">
                                  <div data-popover-html>
                                    <div style="margin: 5px;">
                                      <strong class="size-h4 color-primary" title="{{ $popoverTitle }}">{{ $popoverTitle }}</strong>
                                      <div class="size-h4 text-truncate text-very-compact color-subdue" title="{{ $popoverSubtitle }}">{{ $popoverSubtitle }}</div>
                                      <p class="margin-top-20" style="overflow-y: auto; text-align: justify; max-height: 20rem;">
                                        {{ if ne $popoverSummary "" }}
                                          {{ $popoverSummary }}
                                        {{ else }}
                                          TBA
                                        {{ end }}
                                      </p>
                                     {{ if gt (len ($genres.Array "")) 0 }}
                                      <ul class="attachments margin-top-20">
                                        {{ range $genres.Array "" }}
                                          <li>{{ .String "" }}</li>
                                        {{ end }}
                                      </ul>
                                      {{ end }}
                                    </div>
                                  </div>
                                  <img class="thumbnail" src="{{ $coverUrl }}" alt="Cover for {{ .String "title" }}" loading="lazy" style="width: 100%; height: 100%; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); object-fit: cover; border-radius: 0.5rem;">
                                </div>
                            </div>
                              <div class="shrink min-width-0" style="height: 9rem; position: relative; padding-top: 5px; padding-right: 5px;">
                                <strong class="size-h4 block text-truncate color-primary" title="{{ $title }}">{{ $title }}</strong>
                                <div class="text-truncate text-very-compact" title="{{ $subtitle }}">{{ $subtitle }}</div>
                                <div class="text-very-compact text-truncate">
                                  {{ if eq $service "sonarr" }}
                                    <div>{{ $seString }} - {{ $datetype }} {{ $date.Format "1/2 03:04PM" }}</div>
                                  {{ else }}
                                    <span>{{ $datetype }} {{ $date.Format "1/2" }}</span>
                                  {{ end }}
                                </div>

                                {{ if $showGrabbed }}
                                  {{ if eq $buttonJustify "right" }}
                                    </div>
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="position: absolute; bottom: 1rem; right: 1rem;
                                        {{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                  {{ else }}
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="{{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                    </div>
                                  {{ end }}
                                {{ else }}
                                  <div class="{{ if eq $size "small" }}text-truncate{{ if eq $service "radarr" }} margin-top-5{{ end }}{{ else }}text-truncate-2-lines margin-top-5{{ end }}">
                                    {{ $summary }}
                                  </div>
                                {{ end }}
                            </div>
                          </li>
                        {{ end }}
                      {{ end }}
                      {{ if not $itemDisplayed }}
                        <li>No items found.</li>
                      {{ end }}
                    </ul>
                  {{ end }}

              - type: custom-api
                title: "Sonarr - Récents"
                title-url: ${SONARR_URL}
                cache: 30m
                options:
                  service: sonarr
                  type: recent
                  size: medium
                  collapse-after: 5
                  show-grabbed: true
                  interval: 30
                  sort-time: desc
                  api-base-url: ${SONARR_API_URL}
                  key: ${SONARR_KEY}
                  url: ${SONARR_URL}
                template: |
                  {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
                  {{ $showGrabbed := .Options.BoolOr "show-grabbed" false }}
                  {{ $sortTime := .Options.StringOr "sort-time" "desc" }}
                  {{ $coverProxy := .Options.StringOr "cover-proxy" "" }}
                  {{ $size := .Options.StringOr "size" "medium" }}
                  {{ $service := .Options.StringOr "service" "" }}
                  {{ $type := .Options.StringOr "type" "" }}
                  {{ $intervalH := .Options.IntOr "interval" 0 | mul 24 }}

                  {{ $now := now | formatTime "2006-01-02T15:04:05" }}
                  {{ $posInterval := (offsetNow (printf "+%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}
                  {{ $negInterval := (offsetNow (printf "-%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}

                  {{ $apiBaseUrl := .Options.StringOr "api-base-url" "" }}
                  {{ $key := .Options.StringOr "key" "" }}
                  {{ $url := .Options.StringOr "url" $apiBaseUrl }}

                  {{ if or (and (ne $service "sonarr") (ne $service "radarr") (ne $service "lidarr"))
                           (and (ne $type "upcoming") (ne $type "recent") (ne $type "missing"))
                           (eq $apiBaseUrl "") (eq $key "") (eq $url "") }}
                    <div class="widget-error-header">
                        <div class="color-negative size-h3">ERROR</div>
                        <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                        </svg>
                      </div>
                      <p class="break-all">
                        Some options are not set or malformed
                          <table style="border-spacing: 1rem;">
                            <tr><td>service</td><td>{{ $service }}</td><td>must be sonarr, radarr, or lidarr</td></tr>
                            <tr><td>type</td><td>{{ $type }}</td><td>must be upcoming, recent, or missing</td></tr>
                            <tr><td>api-base-url</td><td>{{ $apiBaseUrl }}</td><td>should include http(s):// and port if needed</td></tr>
                            <tr><td>key</td><td>{{ $key }}</td><td></td></tr>
                          </table>
                      </p>
                  {{ else }}
                    {{ $requestUrl := "" }}

                    {{ if eq $service "sonarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeSeries=true&includeEpisode=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50&includeSeries=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?includeSeries=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "radarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeMovie=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "lidarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v1/history/since?includeArtist=true&includeAlbum=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v1/wanted/missing?page=1&pageSize=50&includeArtist=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v1/calendar?includeArtist=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}
                    {{ end }}

                    {{ $data := newRequest $requestUrl
                      | withHeader "Accept" "application/json"
                      | withHeader "X-Api-Key" $key
                      | getResponse }}

                    <ul class="list list-gap-14 collapsible-container single-line-titles" data-collapse-after="{{ $collapseAfter }}">
                      {{ $array := "" }}
                      {{ $sortByField := "" }}
                      {{ $itemDisplayed := false }}
                      {{ $itemDate := "" }}
                      {{ $isAvailable := false }}

                      {{ if eq $type "missing" }}
                        {{ $array = "records" }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ else if eq $type "recent" }}
                        {{ $sortByField = "date" }}
                      {{ else }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ end }}

                      {{ range $data.JSON.Array $array | sortByTime $sortByField "rfc3339" $sortTime }}

                        {{ if eq $service "sonarr" }}
                          {{ $itemDate = .String "airDateUtc" | parseTime "RFC3339" }}
                          {{ $itemDate = $itemDate.In now.Location | formatTime "2006-01-02T15:04:05" }}
                          {{ $isAvailable = true }}
                        {{ else if eq $service "radarr"}}
                          {{ $isAvailable = .Bool "isAvailable" }}
                          {{ $itemDate = .String "releaseDate" }}
                        {{ else if eq $service "lidarr"}}
                          {{ $itemDate = .String "releaseDate" }}
                          {{ $isAvailable = true }}
                        {{ end }}

                        {{ if or (eq $type "upcoming") (eq $type "recent") (and (or (and (gt $itemDate $negInterval) ((lt $itemDate $now ))) (eq $intervalH 0))  $isAvailable) }}
                          {{ $itemDisplayed = true }}
                          {{ $title := "" }}
                          {{ $subtitle := "" }}
                          {{ $coverUrl := "" }}
                          {{ $status := "" }}
                          {{ $coverBase := "" }}
                          {{ $height := "" }}
                          {{ $width := "" }}
                          {{ $popoverTitle := "" }}
                          {{ $popoverSubtitle := "" }}
                          {{ $popoverSummary := "" }}
                          {{ $summary := "" }}
                          {{ $link := "" }}
                          {{ $grabbed := false }}
                          {{ $date := now }}
                          {{ $datetype := "" }}
                          {{ $seString := "" }}
                          {{ $genres := "" }}
                          {{ $buttonJustify := "left" }}


                          {{ if eq $service "sonarr" }}
                            {{ $series := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "seriesId") $key }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "seriesId") }}
                            {{ end }}
                            {{ $title = .String "series.title" }}
                            {{ $link = printf "%s/series/%s#" $url (.String "series.titleSlug") }}
                            {{ $series = .Get "series" }}
                            {{ $genres = $series.Get "genres" }}

                            {{ if eq $type "recent" }}
                              {{ $date = .String "date" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "episode.title" }}
                              {{ $summary = .String "episode.overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "episode.seasonNumber") (.Int "episode.episodeNumber") }}
                              {{ $datetype = "Downloaded" }}

                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "episode.title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "episode.overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}

                            {{ else if eq $type "missing" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Aired" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ else if eq $type "upcoming" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Airs" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "radarr" }}
                            {{ $movie := "" }}
                            {{ $status = .String "status" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}
                            {{ if eq $status "announced"}}
                              {{ if ne (.String "inCinemas") "" }}
                                {{ $date = (.String "inCinemas" | parseTime "RFC3339") }}
                                {{ $datetype = "In Cinemas" }}
                              {{ else }}
                                {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                            {{ else if eq $status "inCinemas"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Releases" }}
                            {{ else if eq $status "released"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Released" }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "movie.id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "movie.id") }}
                              {{ end }}
                              {{ $datetype = "Downloaded" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $title = .String "movie.title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "movie.overview" }}
                              {{ $popoverTitle = .String "movie.title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "movie.overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "movie.titleSlug") }}
                              {{ $movie = .Get "movie" }}
                              {{ $genres = $movie.Get "genres" }}
                              {{ if and $showGrabbed (gt (.Int "movie.movieFileId") 0) }}
                                {{ $grabbed = true }}
                              {{ end }}
                            {{ else }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "id") }}
                              {{ end }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "titleSlug") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "overview" }}
                              {{ $genres = .Get "genres" }}
                              {{ if eq $type "missing" }}
                                {{ if and $showGrabbed (.Bool "movie.hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ if and $showGrabbed (.Bool "hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "lidarr" }}
                            {{ $artist := "" }}
                            {{ $album := "" }}
                            {{ $albumId := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v1/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ $album = .Get "album" }}
                              {{ $artist = $album.Get "artist" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase (.String "albumId") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase (.String "albumId") }}
                              {{ end }}
                              {{ $grabbed = true }}
                              {{ $title = $album.String "title" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $datetype = "Downloaded" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $summary = $album.String "overview" }}
                              {{ $popoverTitle = $album.String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = $artist.String "overview" }}

                            {{ else }}
                              {{ $artist = .Get "artist" }}
                              {{ $album = .Get "album" }}
                              {{ if eq $type "missing" }}
                                {{ $datetype = "Released" }}
                              {{ else }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                              {{ range .Array "releases" }}
                                {{ $albumId = .String "albumId" }}
                                {{ break }}
                              {{ end }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase $albumId $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase $albumId }}
                              {{ end }}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $summary = $album.String "overview" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "artist.overview" }}
                            {{ end }}
                          {{ end }}

                          {{ if eq $size "small" }}
                            {{ $buttonJustify = "right" }}
                            {{ $height = "9rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "9rem" }}
                            {{ else }}
                              {{ $width = "6rem" }}
                            {{ end }}
                          {{ else if eq $size "medium" }}
                            {{ $height = "12rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "12rem" }}
                            {{ else }}
                              {{ $width = "8rem" }}
                            {{ end }}
                          {{ else if eq $size "large" }}
                            {{ $height = "15rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "15rem" }}
                            {{ else }}
                              {{ $width = "10rem" }}
                            {{ end }}
                          {{ else if eq $size "huge" }}
                            {{ $height = "18rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "18rem" }}
                            {{ else }}
                              {{ $width = "12rem" }}
                            {{ end }}
                          {{ end }}

                          <li style="position: relative;">
                            <div class="flex gap-10 items-start thumbnail-container thumbnail-parent">
                              <div>
                                <div data-popover-type="html" data-popover-position="above" data-popover-show-delay="500" style="width: {{ $width  }}; height: {{ $height }}; align-content: center;">
                                  <div data-popover-html>
                                    <div style="margin: 5px;">
                                      <strong class="size-h4 color-primary" title="{{ $popoverTitle }}">{{ $popoverTitle }}</strong>
                                      <div class="size-h4 text-truncate text-very-compact color-subdue" title="{{ $popoverSubtitle }}">{{ $popoverSubtitle }}</div>
                                      <p class="margin-top-20" style="overflow-y: auto; text-align: justify; max-height: 20rem;">
                                        {{ if ne $popoverSummary "" }}
                                          {{ $popoverSummary }}
                                        {{ else }}
                                          TBA
                                        {{ end }}
                                      </p>
                                     {{ if gt (len ($genres.Array "")) 0 }}
                                      <ul class="attachments margin-top-20">
                                        {{ range $genres.Array "" }}
                                          <li>{{ .String "" }}</li>
                                        {{ end }}
                                      </ul>
                                      {{ end }}
                                    </div>
                                  </div>
                                  <img class="thumbnail" src="{{ $coverUrl }}" alt="Cover for {{ .String "title" }}" loading="lazy" style="width: 100%; height: 100%; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); object-fit: cover; border-radius: 0.5rem;">
                                </div>
                            </div>
                              <div class="shrink min-width-0" style="height: 9rem; position: relative; padding-top: 5px; padding-right: 5px;">
                                <strong class="size-h4 block text-truncate color-primary" title="{{ $title }}">{{ $title }}</strong>
                                <div class="text-truncate text-very-compact" title="{{ $subtitle }}">{{ $subtitle }}</div>
                                <div class="text-very-compact text-truncate">
                                  {{ if eq $service "sonarr" }}
                                    <div>{{ $seString }} - {{ $datetype }} {{ $date.Format "1/2 03:04PM" }}</div>
                                  {{ else }}
                                    <span>{{ $datetype }} {{ $date.Format "1/2" }}</span>
                                  {{ end }}
                                </div>

                                {{ if $showGrabbed }}
                                  {{ if eq $buttonJustify "right" }}
                                    </div>
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="position: absolute; bottom: 1rem; right: 1rem;
                                        {{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                  {{ else }}
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="{{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                    </div>
                                  {{ end }}
                                {{ else }}
                                  <div class="{{ if eq $size "small" }}text-truncate{{ if eq $service "radarr" }} margin-top-5{{ end }}{{ else }}text-truncate-2-lines margin-top-5{{ end }}">
                                    {{ $summary }}
                                  </div>
                                {{ end }}
                            </div>
                          </li>
                        {{ end }}
                      {{ end }}
                      {{ if not $itemDisplayed }}
                        <li>No items found.</li>
                      {{ end }}
                    </ul>
                  {{ end }}

              - type: custom-api
                title: "Sonarr - Manquants"
                title-url: ${SONARR_URL}
                cache: 30m
                options:
                  service: sonarr
                  type: missing
                  size: medium
                  collapse-after: 5
                  show-grabbed: true
                  interval: 90
                  sort-time: desc
                  api-base-url: ${SONARR_API_URL}
                  key: ${SONARR_KEY}
                  url: ${SONARR_URL}
                template: |
                  {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
                  {{ $showGrabbed := .Options.BoolOr "show-grabbed" false }}
                  {{ $sortTime := .Options.StringOr "sort-time" "desc" }}
                  {{ $coverProxy := .Options.StringOr "cover-proxy" "" }}
                  {{ $size := .Options.StringOr "size" "medium" }}
                  {{ $service := .Options.StringOr "service" "" }}
                  {{ $type := .Options.StringOr "type" "" }}
                  {{ $intervalH := .Options.IntOr "interval" 0 | mul 24 }}

                  {{ $now := now | formatTime "2006-01-02T15:04:05" }}
                  {{ $posInterval := (offsetNow (printf "+%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}
                  {{ $negInterval := (offsetNow (printf "-%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}

                  {{ $apiBaseUrl := .Options.StringOr "api-base-url" "" }}
                  {{ $key := .Options.StringOr "key" "" }}
                  {{ $url := .Options.StringOr "url" $apiBaseUrl }}

                  {{ if or (and (ne $service "sonarr") (ne $service "radarr") (ne $service "lidarr"))
                           (and (ne $type "upcoming") (ne $type "recent") (ne $type "missing"))
                           (eq $apiBaseUrl "") (eq $key "") (eq $url "") }}
                    <div class="widget-error-header">
                        <div class="color-negative size-h3">ERROR</div>
                        <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                        </svg>
                      </div>
                      <p class="break-all">
                        Some options are not set or malformed
                          <table style="border-spacing: 1rem;">
                            <tr><td>service</td><td>{{ $service }}</td><td>must be sonarr, radarr, or lidarr</td></tr>
                            <tr><td>type</td><td>{{ $type }}</td><td>must be upcoming, recent, or missing</td></tr>
                            <tr><td>api-base-url</td><td>{{ $apiBaseUrl }}</td><td>should include http(s):// and port if needed</td></tr>
                            <tr><td>key</td><td>{{ $key }}</td><td></td></tr>
                          </table>
                      </p>
                  {{ else }}
                    {{ $requestUrl := "" }}

                    {{ if eq $service "sonarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeSeries=true&includeEpisode=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50&includeSeries=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?includeSeries=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "radarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeMovie=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "lidarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v1/history/since?includeArtist=true&includeAlbum=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v1/wanted/missing?page=1&pageSize=50&includeArtist=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v1/calendar?includeArtist=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}
                    {{ end }}

                    {{ $data := newRequest $requestUrl
                      | withHeader "Accept" "application/json"
                      | withHeader "X-Api-Key" $key
                      | getResponse }}

                    <ul class="list list-gap-14 collapsible-container single-line-titles" data-collapse-after="{{ $collapseAfter }}">
                      {{ $array := "" }}
                      {{ $sortByField := "" }}
                      {{ $itemDisplayed := false }}
                      {{ $itemDate := "" }}
                      {{ $isAvailable := false }}

                      {{ if eq $type "missing" }}
                        {{ $array = "records" }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ else if eq $type "recent" }}
                        {{ $sortByField = "date" }}
                      {{ else }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ end }}

                      {{ range $data.JSON.Array $array | sortByTime $sortByField "rfc3339" $sortTime }}

                        {{ if eq $service "sonarr" }}
                          {{ $itemDate = .String "airDateUtc" | parseTime "RFC3339" }}
                          {{ $itemDate = $itemDate.In now.Location | formatTime "2006-01-02T15:04:05" }}
                          {{ $isAvailable = true }}
                        {{ else if eq $service "radarr"}}
                          {{ $isAvailable = .Bool "isAvailable" }}
                          {{ $itemDate = .String "releaseDate" }}
                        {{ else if eq $service "lidarr"}}
                          {{ $itemDate = .String "releaseDate" }}
                          {{ $isAvailable = true }}
                        {{ end }}

                        {{ if or (eq $type "upcoming") (eq $type "recent") (and (or (and (gt $itemDate $negInterval) ((lt $itemDate $now ))) (eq $intervalH 0))  $isAvailable) }}
                          {{ $itemDisplayed = true }}
                          {{ $title := "" }}
                          {{ $subtitle := "" }}
                          {{ $coverUrl := "" }}
                          {{ $status := "" }}
                          {{ $coverBase := "" }}
                          {{ $height := "" }}
                          {{ $width := "" }}
                          {{ $popoverTitle := "" }}
                          {{ $popoverSubtitle := "" }}
                          {{ $popoverSummary := "" }}
                          {{ $summary := "" }}
                          {{ $link := "" }}
                          {{ $grabbed := false }}
                          {{ $date := now }}
                          {{ $datetype := "" }}
                          {{ $seString := "" }}
                          {{ $genres := "" }}
                          {{ $buttonJustify := "left" }}


                          {{ if eq $service "sonarr" }}
                            {{ $series := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "seriesId") $key }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "seriesId") }}
                            {{ end }}
                            {{ $title = .String "series.title" }}
                            {{ $link = printf "%s/series/%s#" $url (.String "series.titleSlug") }}
                            {{ $series = .Get "series" }}
                            {{ $genres = $series.Get "genres" }}

                            {{ if eq $type "recent" }}
                              {{ $date = .String "date" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "episode.title" }}
                              {{ $summary = .String "episode.overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "episode.seasonNumber") (.Int "episode.episodeNumber") }}
                              {{ $datetype = "Downloaded" }}

                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "episode.title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "episode.overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}

                            {{ else if eq $type "missing" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Aired" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ else if eq $type "upcoming" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Airs" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "radarr" }}
                            {{ $movie := "" }}
                            {{ $status = .String "status" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}
                            {{ if eq $status "announced"}}
                              {{ if ne (.String "inCinemas") "" }}
                                {{ $date = (.String "inCinemas" | parseTime "RFC3339") }}
                                {{ $datetype = "In Cinemas" }}
                              {{ else }}
                                {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                            {{ else if eq $status "inCinemas"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Releases" }}
                            {{ else if eq $status "released"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Released" }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "movie.id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "movie.id") }}
                              {{ end }}
                              {{ $datetype = "Downloaded" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $title = .String "movie.title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "movie.overview" }}
                              {{ $popoverTitle = .String "movie.title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "movie.overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "movie.titleSlug") }}
                              {{ $movie = .Get "movie" }}
                              {{ $genres = $movie.Get "genres" }}
                              {{ if and $showGrabbed (gt (.Int "movie.movieFileId") 0) }}
                                {{ $grabbed = true }}
                              {{ end }}
                            {{ else }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "id") }}
                              {{ end }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "titleSlug") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "overview" }}
                              {{ $genres = .Get "genres" }}
                              {{ if eq $type "missing" }}
                                {{ if and $showGrabbed (.Bool "movie.hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ if and $showGrabbed (.Bool "hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "lidarr" }}
                            {{ $artist := "" }}
                            {{ $album := "" }}
                            {{ $albumId := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v1/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ $album = .Get "album" }}
                              {{ $artist = $album.Get "artist" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase (.String "albumId") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase (.String "albumId") }}
                              {{ end }}
                              {{ $grabbed = true }}
                              {{ $title = $album.String "title" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $datetype = "Downloaded" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $summary = $album.String "overview" }}
                              {{ $popoverTitle = $album.String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = $artist.String "overview" }}

                            {{ else }}
                              {{ $artist = .Get "artist" }}
                              {{ $album = .Get "album" }}
                              {{ if eq $type "missing" }}
                                {{ $datetype = "Released" }}
                              {{ else }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                              {{ range .Array "releases" }}
                                {{ $albumId = .String "albumId" }}
                                {{ break }}
                              {{ end }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase $albumId $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase $albumId }}
                              {{ end }}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $summary = $album.String "overview" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "artist.overview" }}
                            {{ end }}
                          {{ end }}

                          {{ if eq $size "small" }}
                            {{ $buttonJustify = "right" }}
                            {{ $height = "9rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "9rem" }}
                            {{ else }}
                              {{ $width = "6rem" }}
                            {{ end }}
                          {{ else if eq $size "medium" }}
                            {{ $height = "12rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "12rem" }}
                            {{ else }}
                              {{ $width = "8rem" }}
                            {{ end }}
                          {{ else if eq $size "large" }}
                            {{ $height = "15rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "15rem" }}
                            {{ else }}
                              {{ $width = "10rem" }}
                            {{ end }}
                          {{ else if eq $size "huge" }}
                            {{ $height = "18rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "18rem" }}
                            {{ else }}
                              {{ $width = "12rem" }}
                            {{ end }}
                          {{ end }}

                          <li style="position: relative;">
                            <div class="flex gap-10 items-start thumbnail-container thumbnail-parent">
                              <div>
                                <div data-popover-type="html" data-popover-position="above" data-popover-show-delay="500" style="width: {{ $width  }}; height: {{ $height }}; align-content: center;">
                                  <div data-popover-html>
                                    <div style="margin: 5px;">
                                      <strong class="size-h4 color-primary" title="{{ $popoverTitle }}">{{ $popoverTitle }}</strong>
                                      <div class="size-h4 text-truncate text-very-compact color-subdue" title="{{ $popoverSubtitle }}">{{ $popoverSubtitle }}</div>
                                      <p class="margin-top-20" style="overflow-y: auto; text-align: justify; max-height: 20rem;">
                                        {{ if ne $popoverSummary "" }}
                                          {{ $popoverSummary }}
                                        {{ else }}
                                          TBA
                                        {{ end }}
                                      </p>
                                     {{ if gt (len ($genres.Array "")) 0 }}
                                      <ul class="attachments margin-top-20">
                                        {{ range $genres.Array "" }}
                                          <li>{{ .String "" }}</li>
                                        {{ end }}
                                      </ul>
                                      {{ end }}
                                    </div>
                                  </div>
                                  <img class="thumbnail" src="{{ $coverUrl }}" alt="Cover for {{ .String "title" }}" loading="lazy" style="width: 100%; height: 100%; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); object-fit: cover; border-radius: 0.5rem;">
                                </div>
                            </div>
                              <div class="shrink min-width-0" style="height: 9rem; position: relative; padding-top: 5px; padding-right: 5px;">
                                <strong class="size-h4 block text-truncate color-primary" title="{{ $title }}">{{ $title }}</strong>
                                <div class="text-truncate text-very-compact" title="{{ $subtitle }}">{{ $subtitle }}</div>
                                <div class="text-very-compact text-truncate">
                                  {{ if eq $service "sonarr" }}
                                    <div>{{ $seString }} - {{ $datetype }} {{ $date.Format "1/2 03:04PM" }}</div>
                                  {{ else }}
                                    <span>{{ $datetype }} {{ $date.Format "1/2" }}</span>
                                  {{ end }}
                                </div>

                                {{ if $showGrabbed }}
                                  {{ if eq $buttonJustify "right" }}
                                    </div>
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="position: absolute; bottom: 1rem; right: 1rem;
                                        {{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                  {{ else }}
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="{{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                    </div>
                                  {{ end }}
                                {{ else }}
                                  <div class="{{ if eq $size "small" }}text-truncate{{ if eq $service "radarr" }} margin-top-5{{ end }}{{ else }}text-truncate-2-lines margin-top-5{{ end }}">
                                    {{ $summary }}
                                  </div>
                                {{ end }}
                            </div>
                          </li>
                        {{ end }}
                      {{ end }}
                      {{ if not $itemDisplayed }}
                        <li>No items found.</li>
                      {{ end }}
                    </ul>
                  {{ end }}

              - type: custom-api
                title: "Radarr - A venir"
                title-url: ${RADARR_URL}
                cache: 30m
                options:
                  service: radarr
                  type: upcoming
                  size: medium
                  collapse-after: 5
                  show-grabbed: true
                  interval: 30
                  sort-time: asc
                  api-base-url: ${RADARR_API_URL}
                  key: ${RADARR_KEY}
                  url: ${RADARR_URL}
                template: |
                  {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
                  {{ $showGrabbed := .Options.BoolOr "show-grabbed" false }}
                  {{ $sortTime := .Options.StringOr "sort-time" "desc" }}
                  {{ $coverProxy := .Options.StringOr "cover-proxy" "" }}
                  {{ $size := .Options.StringOr "size" "medium" }}
                  {{ $service := .Options.StringOr "service" "" }}
                  {{ $type := .Options.StringOr "type" "" }}
                  {{ $intervalH := .Options.IntOr "interval" 0 | mul 24 }}

                  {{ $now := now | formatTime "2006-01-02T15:04:05" }}
                  {{ $posInterval := (offsetNow (printf "+%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}
                  {{ $negInterval := (offsetNow (printf "-%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}

                  {{ $apiBaseUrl := .Options.StringOr "api-base-url" "" }}
                  {{ $key := .Options.StringOr "key" "" }}
                  {{ $url := .Options.StringOr "url" $apiBaseUrl }}

                  {{ if or (and (ne $service "sonarr") (ne $service "radarr") (ne $service "lidarr"))
                           (and (ne $type "upcoming") (ne $type "recent") (ne $type "missing"))
                           (eq $apiBaseUrl "") (eq $key "") (eq $url "") }}
                    <div class="widget-error-header">
                        <div class="color-negative size-h3">ERROR</div>
                        <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                        </svg>
                      </div>
                      <p class="break-all">
                        Some options are not set or malformed
                          <table style="border-spacing: 1rem;">
                            <tr><td>service</td><td>{{ $service }}</td><td>must be sonarr, radarr, or lidarr</td></tr>
                            <tr><td>type</td><td>{{ $type }}</td><td>must be upcoming, recent, or missing</td></tr>
                            <tr><td>api-base-url</td><td>{{ $apiBaseUrl }}</td><td>should include http(s):// and port if needed</td></tr>
                            <tr><td>key</td><td>{{ $key }}</td><td></td></tr>
                          </table>
                      </p>
                  {{ else }}
                    {{ $requestUrl := "" }}

                    {{ if eq $service "sonarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeSeries=true&includeEpisode=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50&includeSeries=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?includeSeries=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "radarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeMovie=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "lidarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v1/history/since?includeArtist=true&includeAlbum=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v1/wanted/missing?page=1&pageSize=50&includeArtist=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v1/calendar?includeArtist=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}
                    {{ end }}

                    {{ $data := newRequest $requestUrl
                      | withHeader "Accept" "application/json"
                      | withHeader "X-Api-Key" $key
                      | getResponse }}

                    <ul class="list list-gap-14 collapsible-container single-line-titles" data-collapse-after="{{ $collapseAfter }}">
                      {{ $array := "" }}
                      {{ $sortByField := "" }}
                      {{ $itemDisplayed := false }}
                      {{ $itemDate := "" }}
                      {{ $isAvailable := false }}

                      {{ if eq $type "missing" }}
                        {{ $array = "records" }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ else if eq $type "recent" }}
                        {{ $sortByField = "date" }}
                      {{ else }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ end }}

                      {{ range $data.JSON.Array $array | sortByTime $sortByField "rfc3339" $sortTime }}

                        {{ if eq $service "sonarr" }}
                          {{ $itemDate = .String "airDateUtc" | parseTime "RFC3339" }}
                          {{ $itemDate = $itemDate.In now.Location | formatTime "2006-01-02T15:04:05" }}
                          {{ $isAvailable = true }}
                        {{ else if eq $service "radarr"}}
                          {{ $isAvailable = .Bool "isAvailable" }}
                          {{ $itemDate = .String "releaseDate" }}
                        {{ else if eq $service "lidarr"}}
                          {{ $itemDate = .String "releaseDate" }}
                          {{ $isAvailable = true }}
                        {{ end }}

                        {{ if or (eq $type "upcoming") (eq $type "recent") (and (or (and (gt $itemDate $negInterval) ((lt $itemDate $now ))) (eq $intervalH 0))  $isAvailable) }}
                          {{ $itemDisplayed = true }}
                          {{ $title := "" }}
                          {{ $subtitle := "" }}
                          {{ $coverUrl := "" }}
                          {{ $status := "" }}
                          {{ $coverBase := "" }}
                          {{ $height := "" }}
                          {{ $width := "" }}
                          {{ $popoverTitle := "" }}
                          {{ $popoverSubtitle := "" }}
                          {{ $popoverSummary := "" }}
                          {{ $summary := "" }}
                          {{ $link := "" }}
                          {{ $grabbed := false }}
                          {{ $date := now }}
                          {{ $datetype := "" }}
                          {{ $seString := "" }}
                          {{ $genres := "" }}
                          {{ $buttonJustify := "left" }}


                          {{ if eq $service "sonarr" }}
                            {{ $series := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "seriesId") $key }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "seriesId") }}
                            {{ end }}
                            {{ $title = .String "series.title" }}
                            {{ $link = printf "%s/series/%s#" $url (.String "series.titleSlug") }}
                            {{ $series = .Get "series" }}
                            {{ $genres = $series.Get "genres" }}

                            {{ if eq $type "recent" }}
                              {{ $date = .String "date" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "episode.title" }}
                              {{ $summary = .String "episode.overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "episode.seasonNumber") (.Int "episode.episodeNumber") }}
                              {{ $datetype = "Downloaded" }}

                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "episode.title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "episode.overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}

                            {{ else if eq $type "missing" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Aired" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ else if eq $type "upcoming" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Airs" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "radarr" }}
                            {{ $movie := "" }}
                            {{ $status = .String "status" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}
                            {{ if eq $status "announced"}}
                              {{ if ne (.String "inCinemas") "" }}
                                {{ $date = (.String "inCinemas" | parseTime "RFC3339") }}
                                {{ $datetype = "In Cinemas" }}
                              {{ else }}
                                {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                            {{ else if eq $status "inCinemas"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Releases" }}
                            {{ else if eq $status "released"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Released" }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "movie.id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "movie.id") }}
                              {{ end }}
                              {{ $datetype = "Downloaded" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $title = .String "movie.title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "movie.overview" }}
                              {{ $popoverTitle = .String "movie.title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "movie.overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "movie.titleSlug") }}
                              {{ $movie = .Get "movie" }}
                              {{ $genres = $movie.Get "genres" }}
                              {{ if and $showGrabbed (gt (.Int "movie.movieFileId") 0) }}
                                {{ $grabbed = true }}
                              {{ end }}
                            {{ else }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "id") }}
                              {{ end }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "titleSlug") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "overview" }}
                              {{ $genres = .Get "genres" }}
                              {{ if eq $type "missing" }}
                                {{ if and $showGrabbed (.Bool "movie.hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ if and $showGrabbed (.Bool "hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "lidarr" }}
                            {{ $artist := "" }}
                            {{ $album := "" }}
                            {{ $albumId := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v1/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ $album = .Get "album" }}
                              {{ $artist = $album.Get "artist" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase (.String "albumId") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase (.String "albumId") }}
                              {{ end }}
                              {{ $grabbed = true }}
                              {{ $title = $album.String "title" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $datetype = "Downloaded" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $summary = $album.String "overview" }}
                              {{ $popoverTitle = $album.String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = $artist.String "overview" }}

                            {{ else }}
                              {{ $artist = .Get "artist" }}
                              {{ $album = .Get "album" }}
                              {{ if eq $type "missing" }}
                                {{ $datetype = "Released" }}
                              {{ else }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                              {{ range .Array "releases" }}
                                {{ $albumId = .String "albumId" }}
                                {{ break }}
                              {{ end }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase $albumId $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase $albumId }}
                              {{ end }}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $summary = $album.String "overview" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "artist.overview" }}
                            {{ end }}
                          {{ end }}

                          {{ if eq $size "small" }}
                            {{ $buttonJustify = "right" }}
                            {{ $height = "9rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "9rem" }}
                            {{ else }}
                              {{ $width = "6rem" }}
                            {{ end }}
                          {{ else if eq $size "medium" }}
                            {{ $height = "12rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "12rem" }}
                            {{ else }}
                              {{ $width = "8rem" }}
                            {{ end }}
                          {{ else if eq $size "large" }}
                            {{ $height = "15rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "15rem" }}
                            {{ else }}
                              {{ $width = "10rem" }}
                            {{ end }}
                          {{ else if eq $size "huge" }}
                            {{ $height = "18rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "18rem" }}
                            {{ else }}
                              {{ $width = "12rem" }}
                            {{ end }}
                          {{ end }}

                          <li style="position: relative;">
                            <div class="flex gap-10 items-start thumbnail-container thumbnail-parent">
                              <div>
                                <div data-popover-type="html" data-popover-position="above" data-popover-show-delay="500" style="width: {{ $width  }}; height: {{ $height }}; align-content: center;">
                                  <div data-popover-html>
                                    <div style="margin: 5px;">
                                      <strong class="size-h4 color-primary" title="{{ $popoverTitle }}">{{ $popoverTitle }}</strong>
                                      <div class="size-h4 text-truncate text-very-compact color-subdue" title="{{ $popoverSubtitle }}">{{ $popoverSubtitle }}</div>
                                      <p class="margin-top-20" style="overflow-y: auto; text-align: justify; max-height: 20rem;">
                                        {{ if ne $popoverSummary "" }}
                                          {{ $popoverSummary }}
                                        {{ else }}
                                          TBA
                                        {{ end }}
                                      </p>
                                     {{ if gt (len ($genres.Array "")) 0 }}
                                      <ul class="attachments margin-top-20">
                                        {{ range $genres.Array "" }}
                                          <li>{{ .String "" }}</li>
                                        {{ end }}
                                      </ul>
                                      {{ end }}
                                    </div>
                                  </div>
                                  <img class="thumbnail" src="{{ $coverUrl }}" alt="Cover for {{ .String "title" }}" loading="lazy" style="width: 100%; height: 100%; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); object-fit: cover; border-radius: 0.5rem;">
                                </div>
                            </div>
                              <div class="shrink min-width-0" style="height: 9rem; position: relative; padding-top: 5px; padding-right: 5px;">
                                <strong class="size-h4 block text-truncate color-primary" title="{{ $title }}">{{ $title }}</strong>
                                <div class="text-truncate text-very-compact" title="{{ $subtitle }}">{{ $subtitle }}</div>
                                <div class="text-very-compact text-truncate">
                                  {{ if eq $service "sonarr" }}
                                    <div>{{ $seString }} - {{ $datetype }} {{ $date.Format "1/2 03:04PM" }}</div>
                                  {{ else }}
                                    <span>{{ $datetype }} {{ $date.Format "1/2" }}</span>
                                  {{ end }}
                                </div>

                                {{ if $showGrabbed }}
                                  {{ if eq $buttonJustify "right" }}
                                    </div>
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="position: absolute; bottom: 1rem; right: 1rem;
                                        {{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                  {{ else }}
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="{{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                    </div>
                                  {{ end }}
                                {{ else }}
                                  <div class="{{ if eq $size "small" }}text-truncate{{ if eq $service "radarr" }} margin-top-5{{ end }}{{ else }}text-truncate-2-lines margin-top-5{{ end }}">
                                    {{ $summary }}
                                  </div>
                                {{ end }}
                            </div>
                          </li>
                        {{ end }}
                      {{ end }}
                      {{ if not $itemDisplayed }}
                        <li>No items found.</li>
                      {{ end }}
                    </ul>
                  {{ end }}

              - type: custom-api
                title: "Radarr - Récents"
                title-url: ${RADARR_URL}
                cache: 30m
                options:
                  service: radarr
                  type: recent
                  size: medium
                  collapse-after: 5
                  show-grabbed: true
                  interval: 30
                  sort-time: desc
                  api-base-url: ${RADARR_API_URL}
                  key: ${RADARR_KEY}
                  url: ${RADARR_URL}
                template: |
                  {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
                  {{ $showGrabbed := .Options.BoolOr "show-grabbed" false }}
                  {{ $sortTime := .Options.StringOr "sort-time" "desc" }}
                  {{ $coverProxy := .Options.StringOr "cover-proxy" "" }}
                  {{ $size := .Options.StringOr "size" "medium" }}
                  {{ $service := .Options.StringOr "service" "" }}
                  {{ $type := .Options.StringOr "type" "" }}
                  {{ $intervalH := .Options.IntOr "interval" 0 | mul 24 }}

                  {{ $now := now | formatTime "2006-01-02T15:04:05" }}
                  {{ $posInterval := (offsetNow (printf "+%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}
                  {{ $negInterval := (offsetNow (printf "-%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}

                  {{ $apiBaseUrl := .Options.StringOr "api-base-url" "" }}
                  {{ $key := .Options.StringOr "key" "" }}
                  {{ $url := .Options.StringOr "url" $apiBaseUrl }}

                  {{ if or (and (ne $service "sonarr") (ne $service "radarr") (ne $service "lidarr"))
                           (and (ne $type "upcoming") (ne $type "recent") (ne $type "missing"))
                           (eq $apiBaseUrl "") (eq $key "") (eq $url "") }}
                    <div class="widget-error-header">
                        <div class="color-negative size-h3">ERROR</div>
                        <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                        </svg>
                      </div>
                      <p class="break-all">
                        Some options are not set or malformed
                          <table style="border-spacing: 1rem;">
                            <tr><td>service</td><td>{{ $service }}</td><td>must be sonarr, radarr, or lidarr</td></tr>
                            <tr><td>type</td><td>{{ $type }}</td><td>must be upcoming, recent, or missing</td></tr>
                            <tr><td>api-base-url</td><td>{{ $apiBaseUrl }}</td><td>should include http(s):// and port if needed</td></tr>
                            <tr><td>key</td><td>{{ $key }}</td><td></td></tr>
                          </table>
                      </p>
                  {{ else }}
                    {{ $requestUrl := "" }}

                    {{ if eq $service "sonarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeSeries=true&includeEpisode=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50&includeSeries=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?includeSeries=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "radarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeMovie=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "lidarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v1/history/since?includeArtist=true&includeAlbum=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v1/wanted/missing?page=1&pageSize=50&includeArtist=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v1/calendar?includeArtist=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}
                    {{ end }}

                    {{ $data := newRequest $requestUrl
                      | withHeader "Accept" "application/json"
                      | withHeader "X-Api-Key" $key
                      | getResponse }}

                    <ul class="list list-gap-14 collapsible-container single-line-titles" data-collapse-after="{{ $collapseAfter }}">
                      {{ $array := "" }}
                      {{ $sortByField := "" }}
                      {{ $itemDisplayed := false }}
                      {{ $itemDate := "" }}
                      {{ $isAvailable := false }}

                      {{ if eq $type "missing" }}
                        {{ $array = "records" }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ else if eq $type "recent" }}
                        {{ $sortByField = "date" }}
                      {{ else }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ end }}

                      {{ range $data.JSON.Array $array | sortByTime $sortByField "rfc3339" $sortTime }}

                        {{ if eq $service "sonarr" }}
                          {{ $itemDate = .String "airDateUtc" | parseTime "RFC3339" }}
                          {{ $itemDate = $itemDate.In now.Location | formatTime "2006-01-02T15:04:05" }}
                          {{ $isAvailable = true }}
                        {{ else if eq $service "radarr"}}
                          {{ $isAvailable = .Bool "isAvailable" }}
                          {{ $itemDate = .String "releaseDate" }}
                        {{ else if eq $service "lidarr"}}
                          {{ $itemDate = .String "releaseDate" }}
                          {{ $isAvailable = true }}
                        {{ end }}

                        {{ if or (eq $type "upcoming") (eq $type "recent") (and (or (and (gt $itemDate $negInterval) ((lt $itemDate $now ))) (eq $intervalH 0))  $isAvailable) }}
                          {{ $itemDisplayed = true }}
                          {{ $title := "" }}
                          {{ $subtitle := "" }}
                          {{ $coverUrl := "" }}
                          {{ $status := "" }}
                          {{ $coverBase := "" }}
                          {{ $height := "" }}
                          {{ $width := "" }}
                          {{ $popoverTitle := "" }}
                          {{ $popoverSubtitle := "" }}
                          {{ $popoverSummary := "" }}
                          {{ $summary := "" }}
                          {{ $link := "" }}
                          {{ $grabbed := false }}
                          {{ $date := now }}
                          {{ $datetype := "" }}
                          {{ $seString := "" }}
                          {{ $genres := "" }}
                          {{ $buttonJustify := "left" }}


                          {{ if eq $service "sonarr" }}
                            {{ $series := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "seriesId") $key }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "seriesId") }}
                            {{ end }}
                            {{ $title = .String "series.title" }}
                            {{ $link = printf "%s/series/%s#" $url (.String "series.titleSlug") }}
                            {{ $series = .Get "series" }}
                            {{ $genres = $series.Get "genres" }}

                            {{ if eq $type "recent" }}
                              {{ $date = .String "date" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "episode.title" }}
                              {{ $summary = .String "episode.overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "episode.seasonNumber") (.Int "episode.episodeNumber") }}
                              {{ $datetype = "Downloaded" }}

                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "episode.title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "episode.overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}

                            {{ else if eq $type "missing" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Aired" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ else if eq $type "upcoming" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Airs" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "radarr" }}
                            {{ $movie := "" }}
                            {{ $status = .String "status" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}
                            {{ if eq $status "announced"}}
                              {{ if ne (.String "inCinemas") "" }}
                                {{ $date = (.String "inCinemas" | parseTime "RFC3339") }}
                                {{ $datetype = "In Cinemas" }}
                              {{ else }}
                                {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                            {{ else if eq $status "inCinemas"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Releases" }}
                            {{ else if eq $status "released"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Released" }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "movie.id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "movie.id") }}
                              {{ end }}
                              {{ $datetype = "Downloaded" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $title = .String "movie.title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "movie.overview" }}
                              {{ $popoverTitle = .String "movie.title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "movie.overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "movie.titleSlug") }}
                              {{ $movie = .Get "movie" }}
                              {{ $genres = $movie.Get "genres" }}
                              {{ if and $showGrabbed (gt (.Int "movie.movieFileId") 0) }}
                                {{ $grabbed = true }}
                              {{ end }}
                            {{ else }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "id") }}
                              {{ end }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "titleSlug") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "overview" }}
                              {{ $genres = .Get "genres" }}
                              {{ if eq $type "missing" }}
                                {{ if and $showGrabbed (.Bool "movie.hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ if and $showGrabbed (.Bool "hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "lidarr" }}
                            {{ $artist := "" }}
                            {{ $album := "" }}
                            {{ $albumId := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v1/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ $album = .Get "album" }}
                              {{ $artist = $album.Get "artist" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase (.String "albumId") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase (.String "albumId") }}
                              {{ end }}
                              {{ $grabbed = true }}
                              {{ $title = $album.String "title" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $datetype = "Downloaded" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $summary = $album.String "overview" }}
                              {{ $popoverTitle = $album.String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = $artist.String "overview" }}

                            {{ else }}
                              {{ $artist = .Get "artist" }}
                              {{ $album = .Get "album" }}
                              {{ if eq $type "missing" }}
                                {{ $datetype = "Released" }}
                              {{ else }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                              {{ range .Array "releases" }}
                                {{ $albumId = .String "albumId" }}
                                {{ break }}
                              {{ end }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase $albumId $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase $albumId }}
                              {{ end }}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $summary = $album.String "overview" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "artist.overview" }}
                            {{ end }}
                          {{ end }}

                          {{ if eq $size "small" }}
                            {{ $buttonJustify = "right" }}
                            {{ $height = "9rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "9rem" }}
                            {{ else }}
                              {{ $width = "6rem" }}
                            {{ end }}
                          {{ else if eq $size "medium" }}
                            {{ $height = "12rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "12rem" }}
                            {{ else }}
                              {{ $width = "8rem" }}
                            {{ end }}
                          {{ else if eq $size "large" }}
                            {{ $height = "15rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "15rem" }}
                            {{ else }}
                              {{ $width = "10rem" }}
                            {{ end }}
                          {{ else if eq $size "huge" }}
                            {{ $height = "18rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "18rem" }}
                            {{ else }}
                              {{ $width = "12rem" }}
                            {{ end }}
                          {{ end }}

                          <li style="position: relative;">
                            <div class="flex gap-10 items-start thumbnail-container thumbnail-parent">
                              <div>
                                <div data-popover-type="html" data-popover-position="above" data-popover-show-delay="500" style="width: {{ $width  }}; height: {{ $height }}; align-content: center;">
                                  <div data-popover-html>
                                    <div style="margin: 5px;">
                                      <strong class="size-h4 color-primary" title="{{ $popoverTitle }}">{{ $popoverTitle }}</strong>
                                      <div class="size-h4 text-truncate text-very-compact color-subdue" title="{{ $popoverSubtitle }}">{{ $popoverSubtitle }}</div>
                                      <p class="margin-top-20" style="overflow-y: auto; text-align: justify; max-height: 20rem;">
                                        {{ if ne $popoverSummary "" }}
                                          {{ $popoverSummary }}
                                        {{ else }}
                                          TBA
                                        {{ end }}
                                      </p>
                                     {{ if gt (len ($genres.Array "")) 0 }}
                                      <ul class="attachments margin-top-20">
                                        {{ range $genres.Array "" }}
                                          <li>{{ .String "" }}</li>
                                        {{ end }}
                                      </ul>
                                      {{ end }}
                                    </div>
                                  </div>
                                  <img class="thumbnail" src="{{ $coverUrl }}" alt="Cover for {{ .String "title" }}" loading="lazy" style="width: 100%; height: 100%; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); object-fit: cover; border-radius: 0.5rem;">
                                </div>
                            </div>
                              <div class="shrink min-width-0" style="height: 9rem; position: relative; padding-top: 5px; padding-right: 5px;">
                                <strong class="size-h4 block text-truncate color-primary" title="{{ $title }}">{{ $title }}</strong>
                                <div class="text-truncate text-very-compact" title="{{ $subtitle }}">{{ $subtitle }}</div>
                                <div class="text-very-compact text-truncate">
                                  {{ if eq $service "sonarr" }}
                                    <div>{{ $seString }} - {{ $datetype }} {{ $date.Format "1/2 03:04PM" }}</div>
                                  {{ else }}
                                    <span>{{ $datetype }} {{ $date.Format "1/2" }}</span>
                                  {{ end }}
                                </div>

                                {{ if $showGrabbed }}
                                  {{ if eq $buttonJustify "right" }}
                                    </div>
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="position: absolute; bottom: 1rem; right: 1rem;
                                        {{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                  {{ else }}
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="{{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                    </div>
                                  {{ end }}
                                {{ else }}
                                  <div class="{{ if eq $size "small" }}text-truncate{{ if eq $service "radarr" }} margin-top-5{{ end }}{{ else }}text-truncate-2-lines margin-top-5{{ end }}">
                                    {{ $summary }}
                                  </div>
                                {{ end }}
                            </div>
                          </li>
                        {{ end }}
                      {{ end }}
                      {{ if not $itemDisplayed }}
                        <li>No items found.</li>
                      {{ end }}
                    </ul>
                  {{ end }}

              - type: custom-api
                title: "Radarr - Manquants"
                title-url: ${RADARR_URL}
                cache: 30m
                options:
                  service: radarr
                  type: missing
                  size: medium
                  collapse-after: 5
                  show-grabbed: true
                  interval: 90
                  sort-time: desc
                  api-base-url: ${RADARR_API_URL}
                  key: ${RADARR_KEY}
                  url: ${RADARR_URL}
                template: |
                  {{ $collapseAfter := .Options.IntOr "collapse-after" 5 }}
                  {{ $showGrabbed := .Options.BoolOr "show-grabbed" false }}
                  {{ $sortTime := .Options.StringOr "sort-time" "desc" }}
                  {{ $coverProxy := .Options.StringOr "cover-proxy" "" }}
                  {{ $size := .Options.StringOr "size" "medium" }}
                  {{ $service := .Options.StringOr "service" "" }}
                  {{ $type := .Options.StringOr "type" "" }}
                  {{ $intervalH := .Options.IntOr "interval" 0 | mul 24 }}

                  {{ $now := now | formatTime "2006-01-02T15:04:05" }}
                  {{ $posInterval := (offsetNow (printf "+%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}
                  {{ $negInterval := (offsetNow (printf "-%dh" $intervalH)) | formatTime "2006-01-02T15:04:05" }}

                  {{ $apiBaseUrl := .Options.StringOr "api-base-url" "" }}
                  {{ $key := .Options.StringOr "key" "" }}
                  {{ $url := .Options.StringOr "url" $apiBaseUrl }}

                  {{ if or (and (ne $service "sonarr") (ne $service "radarr") (ne $service "lidarr"))
                           (and (ne $type "upcoming") (ne $type "recent") (ne $type "missing"))
                           (eq $apiBaseUrl "") (eq $key "") (eq $url "") }}
                    <div class="widget-error-header">
                        <div class="color-negative size-h3">ERROR</div>
                        <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                        </svg>
                      </div>
                      <p class="break-all">
                        Some options are not set or malformed
                          <table style="border-spacing: 1rem;">
                            <tr><td>service</td><td>{{ $service }}</td><td>must be sonarr, radarr, or lidarr</td></tr>
                            <tr><td>type</td><td>{{ $type }}</td><td>must be upcoming, recent, or missing</td></tr>
                            <tr><td>api-base-url</td><td>{{ $apiBaseUrl }}</td><td>should include http(s):// and port if needed</td></tr>
                            <tr><td>key</td><td>{{ $key }}</td><td></td></tr>
                          </table>
                      </p>
                  {{ else }}
                    {{ $requestUrl := "" }}

                    {{ if eq $service "sonarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeSeries=true&includeEpisode=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50&includeSeries=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?includeSeries=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "radarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v3/history/since?includeMovie=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v3/wanted/missing?page=1&pageSize=50" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v3/calendar?start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}

                    {{ else if eq $service "lidarr" }}
                      {{ if eq $type "recent" }}
                        {{ $requestUrl = printf "%s/api/v1/history/since?includeArtist=true&includeAlbum=true&eventType=grabbed&date=%s" $apiBaseUrl $negInterval }}
                      {{ else if eq $type "missing" }}
                        {{ $requestUrl = printf "%s/api/v1/wanted/missing?page=1&pageSize=50&includeArtist=true" $apiBaseUrl }}
                      {{ else if eq $type "upcoming" }}
                        {{ $requestUrl = printf "%s/api/v1/calendar?includeArtist=true&start=%s&end=%s" $apiBaseUrl $now $posInterval }}
                      {{ end }}
                    {{ end }}

                    {{ $data := newRequest $requestUrl
                      | withHeader "Accept" "application/json"
                      | withHeader "X-Api-Key" $key
                      | getResponse }}

                    <ul class="list list-gap-14 collapsible-container single-line-titles" data-collapse-after="{{ $collapseAfter }}">
                      {{ $array := "" }}
                      {{ $sortByField := "" }}
                      {{ $itemDisplayed := false }}
                      {{ $itemDate := "" }}
                      {{ $isAvailable := false }}

                      {{ if eq $type "missing" }}
                        {{ $array = "records" }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ else if eq $type "recent" }}
                        {{ $sortByField = "date" }}
                      {{ else }}
                        {{ if eq $service "sonarr" }}
                          {{ $sortByField = "airDateUtc" }}
                        {{ else }}
                          {{ $sortByField = "releaseDate" }}
                        {{ end }}
                      {{ end }}

                      {{ range $data.JSON.Array $array | sortByTime $sortByField "rfc3339" $sortTime }}

                        {{ if eq $service "sonarr" }}
                          {{ $itemDate = .String "airDateUtc" | parseTime "RFC3339" }}
                          {{ $itemDate = $itemDate.In now.Location | formatTime "2006-01-02T15:04:05" }}
                          {{ $isAvailable = true }}
                        {{ else if eq $service "radarr"}}
                          {{ $isAvailable = .Bool "isAvailable" }}
                          {{ $itemDate = .String "releaseDate" }}
                        {{ else if eq $service "lidarr"}}
                          {{ $itemDate = .String "releaseDate" }}
                          {{ $isAvailable = true }}
                        {{ end }}

                        {{ if or (eq $type "upcoming") (eq $type "recent") (and (or (and (gt $itemDate $negInterval) ((lt $itemDate $now ))) (eq $intervalH 0))  $isAvailable) }}
                          {{ $itemDisplayed = true }}
                          {{ $title := "" }}
                          {{ $subtitle := "" }}
                          {{ $coverUrl := "" }}
                          {{ $status := "" }}
                          {{ $coverBase := "" }}
                          {{ $height := "" }}
                          {{ $width := "" }}
                          {{ $popoverTitle := "" }}
                          {{ $popoverSubtitle := "" }}
                          {{ $popoverSummary := "" }}
                          {{ $summary := "" }}
                          {{ $link := "" }}
                          {{ $grabbed := false }}
                          {{ $date := now }}
                          {{ $datetype := "" }}
                          {{ $seString := "" }}
                          {{ $genres := "" }}
                          {{ $buttonJustify := "left" }}


                          {{ if eq $service "sonarr" }}
                            {{ $series := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "seriesId") $key }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                              {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "seriesId") }}
                            {{ end }}
                            {{ $title = .String "series.title" }}
                            {{ $link = printf "%s/series/%s#" $url (.String "series.titleSlug") }}
                            {{ $series = .Get "series" }}
                            {{ $genres = $series.Get "genres" }}

                            {{ if eq $type "recent" }}
                              {{ $date = .String "date" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "episode.title" }}
                              {{ $summary = .String "episode.overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "episode.seasonNumber") (.Int "episode.episodeNumber") }}
                              {{ $datetype = "Downloaded" }}

                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "episode.title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "episode.overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}

                            {{ else if eq $type "missing" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Aired" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "episode.hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ else if eq $type "upcoming" }}
                              {{ $date = .String "airDateUtc" | parseLocalTime "RFC3339" }}
                              {{ $date = $date.In now.Location }}
                              {{ $subtitle = .String "title" }}
                              {{ $summary = .String "overview" }}
                              {{ $seString = printf "S%02dE%02d" (.Int "seasonNumber") (.Int "episodeNumber") }}
                              {{ $datetype = "Airs" }}
                              {{ if $showGrabbed }}
                                {{ $popoverTitle = .String "title" }}
                                {{ $popoverSubtitle = $seString }}
                                {{ $popoverSummary = .String "overview" }}
                                {{ if .Bool "hasFile" }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ $popoverTitle = .String "series.title" }}
                                {{ $popoverSummary = .String "series.overview" }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "radarr" }}
                            {{ $movie := "" }}
                            {{ $status = .String "status" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v3/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}
                            {{ if eq $status "announced"}}
                              {{ if ne (.String "inCinemas") "" }}
                                {{ $date = (.String "inCinemas" | parseTime "RFC3339") }}
                                {{ $datetype = "In Cinemas" }}
                              {{ else }}
                                {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                            {{ else if eq $status "inCinemas"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Releases" }}
                            {{ else if eq $status "released"}}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $datetype = "Released" }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "movie.id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "movie.id") }}
                              {{ end }}
                              {{ $datetype = "Downloaded" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $title = .String "movie.title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "movie.overview" }}
                              {{ $popoverTitle = .String "movie.title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "movie.overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "movie.titleSlug") }}
                              {{ $movie = .Get "movie" }}
                              {{ $genres = $movie.Get "genres" }}
                              {{ if and $showGrabbed (gt (.Int "movie.movieFileId") 0) }}
                                {{ $grabbed = true }}
                              {{ end }}
                            {{ else }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg?apikey=%s" $coverBase (.String "id") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/%s/poster-500.jpg" $coverBase (.String "id") }}
                              {{ end }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = "" }}
                              {{ $summary = .String "overview" }}
                              {{ $link = printf "%s/movie/%s#" $url (.String "titleSlug") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "overview" }}
                              {{ $genres = .Get "genres" }}
                              {{ if eq $type "missing" }}
                                {{ if and $showGrabbed (.Bool "movie.hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ else }}
                                {{ if and $showGrabbed (.Bool "hasFile") }}
                                  {{ $grabbed = true }}
                                {{ end }}
                              {{ end }}
                            {{ end }}


                          {{ else if eq $service "lidarr" }}
                            {{ $artist := "" }}
                            {{ $album := "" }}
                            {{ $albumId := "" }}
                            {{ if eq $coverProxy "" }}
                              {{ $coverBase = printf "%s/api/v1/mediacover" $apiBaseUrl }}
                            {{ else }}
                              {{ $coverBase = $coverProxy }}
                            {{ end }}

                            {{ if eq $type "recent" }}
                              {{ $album = .Get "album" }}
                              {{ $artist = $album.Get "artist" }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase (.String "albumId") $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase (.String "albumId") }}
                              {{ end }}
                              {{ $grabbed = true }}
                              {{ $title = $album.String "title" }}
                              {{ $date = (.String "date" | parseTime "RFC3339") }}
                              {{ $datetype = "Downloaded" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $summary = $album.String "overview" }}
                              {{ $popoverTitle = $album.String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = $artist.String "overview" }}

                            {{ else }}
                              {{ $artist = .Get "artist" }}
                              {{ $album = .Get "album" }}
                              {{ if eq $type "missing" }}
                                {{ $datetype = "Released" }}
                              {{ else }}
                                {{ $datetype = "Releases" }}
                              {{ end }}
                              {{ range .Array "releases" }}
                                {{ $albumId = .String "albumId" }}
                                {{ break }}
                              {{ end }}
                              {{ if eq $coverProxy "" }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg?apikey=%s" $coverBase $albumId $key }}
                              {{ else }}
                                {{ $coverUrl = printf "%s/album/%s/cover-500.jpg" $coverBase $albumId }}
                              {{ end }}
                              {{ $date = (.String "releaseDate" | parseTime "RFC3339") }}
                              {{ $title = .String "title" }}
                              {{ $subtitle = $artist.String "artistName" }}
                              {{ $summary = $album.String "overview" }}
                              {{ $genres = $artist.Get "genres" }}
                              {{ $link = printf "%s/artist/%s#" $url ($artist.String "foreignArtistId") }}
                              {{ $popoverTitle = .String "title" }}
                              {{ $popoverSubtitle = printf "%s %s" $datetype ($date | formatTime "1/2/2006") }}
                              {{ $popoverSummary = .String "artist.overview" }}
                            {{ end }}
                          {{ end }}

                          {{ if eq $size "small" }}
                            {{ $buttonJustify = "right" }}
                            {{ $height = "9rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "9rem" }}
                            {{ else }}
                              {{ $width = "6rem" }}
                            {{ end }}
                          {{ else if eq $size "medium" }}
                            {{ $height = "12rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "12rem" }}
                            {{ else }}
                              {{ $width = "8rem" }}
                            {{ end }}
                          {{ else if eq $size "large" }}
                            {{ $height = "15rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "15rem" }}
                            {{ else }}
                              {{ $width = "10rem" }}
                            {{ end }}
                          {{ else if eq $size "huge" }}
                            {{ $height = "18rem" }}
                            {{ if eq $service "lidarr" }}
                              {{ $width = "18rem" }}
                            {{ else }}
                              {{ $width = "12rem" }}
                            {{ end }}
                          {{ end }}

                          <li style="position: relative;">
                            <div class="flex gap-10 items-start thumbnail-container thumbnail-parent">
                              <div>
                                <div data-popover-type="html" data-popover-position="above" data-popover-show-delay="500" style="width: {{ $width  }}; height: {{ $height }}; align-content: center;">
                                  <div data-popover-html>
                                    <div style="margin: 5px;">
                                      <strong class="size-h4 color-primary" title="{{ $popoverTitle }}">{{ $popoverTitle }}</strong>
                                      <div class="size-h4 text-truncate text-very-compact color-subdue" title="{{ $popoverSubtitle }}">{{ $popoverSubtitle }}</div>
                                      <p class="margin-top-20" style="overflow-y: auto; text-align: justify; max-height: 20rem;">
                                        {{ if ne $popoverSummary "" }}
                                          {{ $popoverSummary }}
                                        {{ else }}
                                          TBA
                                        {{ end }}
                                      </p>
                                     {{ if gt (len ($genres.Array "")) 0 }}
                                      <ul class="attachments margin-top-20">
                                        {{ range $genres.Array "" }}
                                          <li>{{ .String "" }}</li>
                                        {{ end }}
                                      </ul>
                                      {{ end }}
                                    </div>
                                  </div>
                                  <img class="thumbnail" src="{{ $coverUrl }}" alt="Cover for {{ .String "title" }}" loading="lazy" style="width: 100%; height: 100%; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); object-fit: cover; border-radius: 0.5rem;">
                                </div>
                            </div>
                              <div class="shrink min-width-0" style="height: 9rem; position: relative; padding-top: 5px; padding-right: 5px;">
                                <strong class="size-h4 block text-truncate color-primary" title="{{ $title }}">{{ $title }}</strong>
                                <div class="text-truncate text-very-compact" title="{{ $subtitle }}">{{ $subtitle }}</div>
                                <div class="text-very-compact text-truncate">
                                  {{ if eq $service "sonarr" }}
                                    <div>{{ $seString }} - {{ $datetype }} {{ $date.Format "1/2 03:04PM" }}</div>
                                  {{ else }}
                                    <span>{{ $datetype }} {{ $date.Format "1/2" }}</span>
                                  {{ end }}
                                </div>

                                {{ if $showGrabbed }}
                                  {{ if eq $buttonJustify "right" }}
                                    </div>
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="position: absolute; bottom: 1rem; right: 1rem;
                                        {{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                  {{ else }}
                                    <a href="{{ $link }}" class="bookmarks-link size-h4 color-primary" target="_blank" rel="noreferrer"
                                      style="{{ if $grabbed }} color: var(--color-positive); border: 1px solid var(--color-positive); {{ else }} color: var(--color-negative); border: 1px solid var(--color-negative); {{ end }}
                                        font-weight: bold; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 5px; text-decoration: none;">
                                    {{ if $grabbed }}Grabbed{{ else }}Missing{{ end }}
                                    </a>
                                    </div>
                                  {{ end }}
                                {{ else }}
                                  <div class="{{ if eq $size "small" }}text-truncate{{ if eq $service "radarr" }} margin-top-5{{ end }}{{ else }}text-truncate-2-lines margin-top-5{{ end }}">
                                    {{ $summary }}
                                  </div>
                                {{ end }}
                            </div>
                          </li>
                        {{ end }}
                      {{ end }}
                      {{ if not $itemDisplayed }}
                        <li>No items found.</li>
                      {{ end }}
                    </ul>
                  {{ end }}

          - type: custom-api
            title: Jellyseerr - Requetes
            title-url: ${JELLYSEERR_URL}/requests
            url: ${JELLYSEERR_URL}/api/v1/request/count
            cache: 1h
            options:
              small-column: false
              compact: false
            headers:
              accept: "application/json"
              x-api-key: ${JELLYSEERR_API_KEY}
            template: |
              {{ if eq .Response.StatusCode 200 }}
                <div class="flex justify-evenly text-center">
                  <div>
                    <div class="color-highlight size-h1">{{ .JSON.Int "total" | formatNumber }}</div>
                    <div class="size-h3">Total</div>
                  </div>
                  <div>
                    <div class="color-highlight size-h1">{{ .JSON.Int "movie" | formatNumber }}</div>
                    <div class="size-h3">Films</div>
                  </div>
                  <div>
                    <div class="color-highlight size-h1">{{ .JSON.Int "tv" | formatNumber }}</div>
                    <div class="size-h3">Series</div>
                  </div>
                </div>
                <div class="flex justify-evenly text-center margin-top-20">
                  <div>
                    <div class="color-highlight size-h1">{{ .JSON.Int "pending" | formatNumber }}</div>
                    <div class="size-h3">En attente</div>
                  </div>
                  <div>
                    <div class="color-highlight size-h1">{{ .JSON.Int "approved" | formatNumber }}</div>
                    <div class="size-h3">Approuvees</div>
                  </div>
                  <div>
                    <div class="color-highlight size-h1">{{ .JSON.Int "processing" | formatNumber }}</div>
                    <div class="size-h3">En cours</div>
                  </div>
                  <div>
                    <div class="color-highlight size-h1">{{ .JSON.Int "available" | formatNumber }}</div>
                    <div class="size-h3">Disponibles</div>
                  </div>
                </div>
              {{ else }}
                <p class="color-negative">Impossible de contacter Jellyseerr ({{ .Response.StatusCode }})</p>
              {{ end }}
